# üìñ –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Ring Buffer

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
```bash
cd /home/nvidia/deep_cv_football/my_ring_buffer
make clean && make
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
GST_PLUGIN_PATH=/home/nvidia/deep_cv_football/my_ring_buffer \
gst-inspect-1.0 nvdsringbuf
```

## üß™ –¢–ï–°–¢–´

### –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ (videotestsrc)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º "–º—è—á–∏–∫" –Ω–∞ 10 —Å–µ–∫—É–Ω–¥
GST_PLUGIN_PATH=/home/nvidia/deep_cv_football/my_ring_buffer \
GST_DEBUG=nvdsringbuf:3 \
gst-launch-1.0 \
    videotestsrc num-buffers=300 pattern=ball ! \
    video/x-raw,width=640,height=480,framerate=30/1 ! \
    nvvideoconvert ! \
    "video/x-raw(memory:NVMM),format=RGBA" ! \
    nvdsringbuf \
        ring-bytes=110592000 \
        min-slots=90 \
        chunk=1 ! \
    fakesink
```

**–ß—Ç–æ —É–≤–∏–¥–∏—Ç–µ:**
- "Accumulating: 30/90 frames" - –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
- "Buffer filled! Starting delayed output" - –Ω–∞—á–∞–ª–æ –≤—ã–≤–æ–¥–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- "Output frame X with delay of 90 frames (3.0 sec)" - —Ä–∞–±–æ—Ç–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

### –¢–µ—Å—Ç 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤–∏–¥–µ–æ
```bash
cd /home/nvidia/deep_cv_football/new_week

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ —Å 3-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
python3 /home/nvidia/deep_cv_football/my_ring_buffer/test_performance.py \
    --seconds 3 \
    --duration 30
```

**–ß—Ç–æ —É–≤–∏–¥–∏—Ç–µ:**
```
üìä FPS: Direct=30.0 | Buffered=30.0 | Delay=3.0s | CPU=15.2% | RAM=3.85GB
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--seconds 3` - —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1-5)
- `--duration 30` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

### –¢–µ—Å—Ç 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –≤–µ—Ç–æ–∫ (–ø—Ä—è–º–∞—è vs –∑–∞–¥–µ—Ä–∂–∫–∞)
```bash
cd /home/nvidia/deep_cv_football/new_week
python3 /home/nvidia/deep_cv_football/my_ring_buffer/test_simple_timing.py
```

**–í—ã–≤–æ–¥:**
```
‚ö° –ü—Ä—è–º–æ–π:    –∫–∞–¥—Ä  300 | PTS: 10.0s | –ü—Ä–æ—à–ª–æ: 10.0s
üîÑ –ë—É—Ñ–µ—Ä:     –∫–∞–¥—Ä  210 | PTS:  7.0s | –ü—Ä–æ—à–ª–æ: 10.0s | –ó–∞–¥–µ—Ä–∂–∫–∞: 3.0s
```

### –¢–µ—Å—Ç 4: –í–∏–∑—É–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
```bash
python3 /home/nvidia/deep_cv_football/my_ring_buffer/final_delay_demo.py
```

–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç —Å videotestsrc –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã.

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –° –±—É—Ñ–µ—Ä–æ–º 3 —Å–µ–∫—É–Ω–¥—ã (90 —Å–ª–æ—Ç–æ–≤):
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **FPS –ø—Ä—è–º–æ–π** | 29-30 | ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è |
| **FPS –±—É—Ñ–µ—Ä** | 29-30 | ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è |
| **–ó–∞–¥–µ—Ä–∂–∫–∞** | 3.0¬±0.1 —Å–µ–∫ | ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è |
| **CPU** | 10-20% | ‚úÖ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ |
| **RAM** | 3.6-3.9 GB | ‚úÖ –û–∂–∏–¥–∞–µ–º–æ |

### –° –±—É—Ñ–µ—Ä–æ–º 5 —Å–µ–∫—É–Ω–¥ (150 —Å–ª–æ—Ç–æ–≤):
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **FPS** | 29-30 | ‚úÖ |
| **–ó–∞–¥–µ—Ä–∂–∫–∞** | 5.0¬±0.1 —Å–µ–∫ | ‚úÖ |
| **RAM** | 6.0-6.2 GB | ‚ö†Ô∏è –ù—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä |

## üõ†Ô∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–≥–∏–Ω–∞

```bash
nvdsringbuf \
    ring-bytes=X \      # –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –≤ –±–∞–π—Ç–∞—Ö
    min-slots=Y \       # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ (–∫–∞–¥—Ä–æ–≤)
    chunk=1 \           # –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
    preregister-cuda=false  # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è CUDA (–æ–±—ã—á–Ω–æ false)
```

### –†–∞—Å—á—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
```python
# –î–ª—è 3 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ 30 FPS
slots = 3 * 30  # 90 —Å–ª–æ—Ç–æ–≤
ring_bytes = slots * width * height * 4  # RGBA

# –ü—Ä–∏–º–µ—Ä—ã:
# 640√ó480:   90 * 640 * 480 * 4 = 110,592,000
# 1920√ó1080: 90 * 1920 * 1080 * 4 = 746,496,000
# 5700√ó1900: 90 * 5700 * 1900 * 4 = 3,898,800,000
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥:
```bash
export GST_DEBUG=nvdsringbuf:5
```

### –í–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–µ:
- `"Accumulating: X/Y frames"` - –∏–¥—ë—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ
- `"Buffer filled! Starting delayed output"` - –±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω
- `"Output frame X with delay of Y frames"` - –≤—ã–≤–æ–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. "Failed to allocate"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 2. FPS < 25
**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –±—É—Ñ–µ—Ä –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ –∏–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ

### 3. –ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è
**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync=false` –≤ sink —ç–ª–µ–º–µ–Ω—Ç–∞—Ö

## üí° –°–æ–≤–µ—Ç—ã

1. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 3 —Å–µ–∫—É–Ω–¥—ã (90 —Å–ª–æ—Ç–æ–≤)
2. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:** –º–æ–∂–Ω–æ –¥–æ 5 —Å–µ–∫—É–Ω–¥ (150 —Å–ª–æ—Ç–æ–≤) –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_performance.py` –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è FPS
4. **–ü–∞–º—è—Ç—å:** ~41 MB –Ω–∞ –∫–∞–¥—Ä –ø–∞–Ω–æ—Ä–∞–º—ã (5700√ó1900√ó4)

## üìù –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –≤–∞—à pipeline

```python
# Python GStreamer
pipeline_str = f"""
    ... –≤–∞—à –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ ... !
    nvdsstitch ... !  # —Å–∫–ª–µ–π–∫–∞ –ø–∞–Ω–æ—Ä–∞–º—ã

    tee name=splitter

    # –í–µ—Ç–∫–∞ 1: –ø—Ä—è–º–∞—è (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
    splitter. ! queue ! autovideosink

    # –í–µ—Ç–∫–∞ 2: —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞)
    splitter. ! queue !
    nvdsringbuf
        ring-bytes={90 * 5700 * 1900 * 4}
        min-slots=90 !
    ... –≤–∞—à–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
"""
```

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ring buffer —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö!