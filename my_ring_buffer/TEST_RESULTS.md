# ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø RING BUFFER

## –î–∞—Ç–∞: 14.11.2024

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∏ –†–µ—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞
Ring buffer –≤–æ–∑–≤—Ä–∞—â–∞–ª `FLOW_DROPPED` –≤–æ –≤—Ä–µ–º—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è ‚Üí `tee` —ç–ª–µ–º–µ–Ω—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è ‚Üí –≤–µ—Å—å pipeline –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –ø–æ—Å–ª–µ 2-3 –∫–∞–¥—Ä–æ–≤.

### –†–µ—à–µ–Ω–∏–µ
–ó–∞–º–µ–Ω–∏–ª–∏ `FLOW_DROPPED` –Ω–∞ `FLOW_OK` (pass-through —Ä–µ–∂–∏–º) ‚Üí tee –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ‚Üí –æ–±–µ –≤–µ—Ç–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–∞–¥—Ä—ã.

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –∫–æ–¥–µ (1 —Å—Ç—Ä–æ–∫–∞):**
```cpp
// –ë—ã–ª–æ:
return GST_BASE_TRANSFORM_FLOW_DROPPED;

// –°—Ç–∞–ª–æ:
return GST_FLOW_OK;  // Pass-through
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: Standalone (–±–µ–∑ tee)
‚úÖ **–£–°–ü–ï–•**
- –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 120 –∫–∞–¥—Ä–æ–≤
- –ë—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–∏–ª—Å—è –Ω–∞ –∫–∞–¥—Ä–µ 30
- –ù–∞—á–∞–ª –≤—ã–¥–∞–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∞–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
- Pipeline –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å EOS

### –¢–µ—Å—Ç 2: –° tee element (–≥–ª–∞–≤–Ω—ã–π —Ç–µ—Å—Ç)
‚úÖ **–£–°–ü–ï–•**
- **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 3 –∫–∞–¥—Ä–∞ ‚Üí STOP ‚ùå
- **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 960+ –∫–∞–¥—Ä–æ–≤ –∑–∞ 12 —Å–µ–∫—É–Ω–¥ ‚úÖ

**–î–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ—Å—Ç–∞:**
```
–ö–∞–¥—Ä 600:  ‚ö° Direct PTS=19.97s  üîÑ Buffered PTS=19.97s
–ö–∞–¥—Ä 690:  ‚ö° Direct PTS=22.97s  üîÑ Buffered PTS=22.97s
–ö–∞–¥—Ä 780:  ‚ö° Direct PTS=25.97s  üîÑ Buffered PTS=25.97s
–ö–∞–¥—Ä 870:  ‚ö° Direct PTS=28.97s  üîÑ Buffered PTS=28.97s
–ö–∞–¥—Ä 960:  ‚ö° Direct PTS=31.97s  üîÑ Buffered PTS=31.97s
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ –û–±–µ –≤–µ—Ç–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- ‚úÖ FPS —Å—Ç–∞–±–∏–ª—å–Ω—ã–π ~100+ FPS
- ‚úÖ PTS —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- ‚úÖ Pipeline –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

---

## üìà –ü–æ–≤–µ–¥–µ–Ω–∏–µ Ring Buffer

### –§–∞–∑–∞ 1: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ (–∫–∞–¥—Ä—ã 0-89)
- –í—Ö–æ–¥–Ω–æ–π –∫–∞–¥—Ä ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ ring buffer
- –í—ã—Ö–æ–¥: **–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–∞–¥—Ä** (pass-through)
- PTS: —Å–æ–≤–ø–∞–¥–∞—é—Ç –Ω–∞ –æ–±–µ–∏—Ö –≤–µ—Ç–∫–∞—Ö

### –§–∞–∑–∞ 2: –ó–∞–¥–µ—Ä–∂–∫–∞ (–∫–∞–¥—Ä—ã 90+)
- –í—Ö–æ–¥–Ω–æ–π –∫–∞–¥—Ä ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ ring buffer
- –í—ã—Ö–æ–¥: **—Å—Ç–∞—Ä—ã–π –∫–∞–¥—Ä –∏–∑ –±—É—Ñ–µ—Ä–∞** (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 3 —Å–µ–∫)
- PTS: —Å–¥–≤–∏–≥ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã (–µ—Å–ª–∏ –∏–∑–º–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –∫–∞–¥—Ä–∞ 90)

---

## üéØ –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. Ring buffer —Å–æ–≤–º–µ—Å—Ç–∏–º —Å `tee` element
2. –û–±–µ –≤–µ—Ç–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–∞–¥—Ä—ã –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ
3. FPS —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –Ω–∞ –æ–±–µ–∏—Ö –≤–µ—Ç–∫–∞—Ö
4. Pipeline –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

### ‚ö†Ô∏è  –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:
–ü–µ—Ä–≤—ã–µ 90 –∫–∞–¥—Ä–æ–≤ (3 —Å–µ–∫—É–Ω–¥—ã) –Ω–∞ buffered –≤–µ—Ç–∫–µ –∏–¥—É—Ç **–ë–ï–ó –∑–∞–¥–µ—Ä–∂–∫–∏** (pass-through). –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–≥—Ä–µ–≤–∞ –±—É—Ñ–µ—Ä–∞.

–ü–æ—Å–ª–µ –∫–∞–¥—Ä–∞ 90 –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ 3 —Å–µ–∫—É–Ω–¥—ã.

### üìã –î–ª—è virtualcam/panorama —ç—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ:
- –ü–µ—Ä–≤—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã: –≤–∏–¥–µ–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–∂–∏–≤–æ–µ"
- –ü–æ—Å–ª–µ 3 —Å–µ–∫—É–Ω–¥: –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

Ring buffer –ø–ª–∞–≥–∏–Ω **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω** –∏ –≥–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ!

**–§–∞–π–ª—ã:**
- –ü–ª–∞–≥–∏–Ω: `/home/nvidia/deep_cv_football/my_ring_buffer/libgstnvdsringbuf.so`
- –¢–µ—Å—Ç—ã: `test_tee_ringbuffer.py`, `test_ringbuf_standalone.py`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `RING_BUFFER_FIX_SUMMARY.md`, `TEST_RESULTS.md`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
ringbuffer_path = "/home/nvidia/deep_cv_football/my_ring_buffer"
os.environ['GST_PLUGIN_PATH'] = f"{ringbuffer_path}:..."

# –í pipeline:
nvdsringbuf
    ring-bytes={buffer_size}
    min-slots={num_frames}
    chunk=1
    preregister-cuda=false !
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£
