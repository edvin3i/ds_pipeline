# ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: Ring Buffer –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ ring buffer —Å tee –≤—ã—è–≤–ª–µ–Ω–æ:

```
‚ö° Direct FPS:   2.0 ‚Üí 1.0 ‚Üí 0.7 ‚Üí 0.5 ‚Üí ... ‚Üí 0.0
üîÑ Buffered FPS: 0.0 ‚Üí 0.0 ‚Üí 0.0 ‚Üí ... ‚Üí 0.0 (–≤—Å–µ–≥–¥–∞!)
```

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
1. –ü–µ—Ä–≤—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã (90 –∫–∞–¥—Ä–æ–≤): ring buffer –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç
2. –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø—É—Å–∫–∞—Ç—å –∫–∞–¥—Ä—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 3 —Å–µ–∫
3. Direct –≤–µ—Ç–∫–∞: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ 30 FPS
4. Buffered –≤–µ—Ç–∫–∞: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ 30 FPS (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)

### –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
1. Ring buffer –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –∫–∞–¥—Ä—ã
2. **–ù–ï –ù–ê–ß–ò–ù–ê–ï–¢ –≤—ã–ø—É—Å–∫–∞—Ç—å** –∫–∞–¥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
3. Direct –≤–µ—Ç–∫–∞: FPS –ø–∞–¥–∞ –µ—Ç –¥–æ 0 (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è upstream)
4. Buffered –≤–µ—Ç–∫–∞: FPS –≤—Å–µ–≥–¥–∞ 0 (–Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç)

## üêõ –ü—Ä–∏—á–∏–Ω–∞:

Ring buffer –ø–ª–∞–≥–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å pipeline, –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—è—Å—å –≤ —Ä–µ–∂–∏–º passthrough –ø–æ—Å–ª–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞.

## üìä –¢–µ—Å—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:

```bash
cd /home/nvidia/deep_cv_football/my_ring_buffer
python3 test_performance_benchmark.py
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: FPS –ø–∞–¥–∞–µ—Ç –¥–æ 0 —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

–í –ø–ª–∞–≥–∏–Ω–µ nvdsringbuf –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞** (accumulated_frames >= delay_frames):
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º "–≤—ã–ø—É—Å–∫–∞ –∫–∞–¥—Ä–æ–≤"
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–¥—Ä–∞: –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É—Ñ–µ—Ä, –í–´–ü–£–°–¢–ò–¢–¨ —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π

2. **–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è):
   ```cpp
   if (accumulated_frames < delay_frames) {
       return GST_FLOW_OK;  // –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ
   } else {
       // ??? –ß—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ - –∫–∞–¥—Ä—ã –Ω–µ –≤—ã—Ö–æ–¥—è—Ç
   }
   ```

3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
   ```cpp
   if (accumulated_frames < delay_frames) {
       return GST_FLOW_OK;  // –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ
   } else {
       // –í—ã–ø—É—Å–∫–∞–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π –∫–∞–¥—Ä –∏–∑ –±—É—Ñ–µ—Ä–∞
       push_oldest_frame();
       return GST_FLOW_OK;
   }
   ```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ:

–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ ring buffer –ø–ª–∞–≥–∏–Ω–∞ –≤ —Ñ–∞–π–ª–µ:
- `/home/nvidia/deep_cv_football/my_ring_buffer/src/gstnvdsringbuf.cpp`

–û—Å–æ–±–µ–Ω–Ω–æ —Ñ—É–Ω–∫—Ü–∏—é `gst_nvds_ring_buffer_transform_ip()` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é.

---

**–î–∞—Ç–∞**: 14.11.2024
**–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞