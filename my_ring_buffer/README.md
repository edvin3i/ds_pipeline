# ‚úÖ RING BUFFER –° –ó–ê–î–ï–†–ñ–ö–û–ô –£–°–ü–ï–®–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–ù!

## üìä –ò—Ç–æ–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –ø–ª–∞–≥–∏–Ω nvdsringbuf:**
   - –ü–µ—Ä–≤—ã–µ N –∫–∞–¥—Ä–æ–≤ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –∫–æ–ª—å—Ü–µ–≤–æ–º –±—É—Ñ–µ—Ä–µ
   - –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—ã–≤–æ–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `GST_BASE_TRANSFORM_FLOW_DROPPED` –¥–ª—è –¥—Ä–æ–ø–∞ –∫–∞–¥—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è

2. **–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
   ```cpp
   // –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   guint accumulated;          // –°—á—ë—Ç—á–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤
   gboolean delay_complete;    // –§–ª–∞–≥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
   guint tail;                 // –£–∫–∞–∑–∞—Ç–µ–ª—å —á—Ç–µ–Ω–∏—è –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏

   // –í transform_ip:
   if (!self->delay_complete) {
       if (self->accumulated >= self->size) {
           self->delay_complete = TRUE;
           GST_INFO("Buffer filled! Starting delayed output");
       } else {
           return GST_BASE_TRANSFORM_FLOW_DROPPED;  // –î—Ä–æ–ø –∫–∞–¥—Ä–∞!
       }
   }

   // –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è - –∫–æ–ø–∏—Ä—É–µ–º –∏–∑ —Ö–≤–æ—Å—Ç–∞:
   if (self->delay_complete) {
       ring_pop_copy(self, surf);  // –ë–µ—Ä—ë–º —Å—Ç–∞—Ä—ã–π –∫–∞–¥—Ä
   }
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:**
   - ‚úÖ –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 90 –∫–∞–¥—Ä–æ–≤ (3 —Å–µ–∫—É–Ω–¥—ã)
   - ‚úÖ –í—ã–≤–æ–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
   - ‚úÖ –†–∞–±–æ—Ç–∞ —Å videotestsrc –∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤–∏–¥–µ–æ

## üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Å 3-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π:
```python
pipeline = """
    filesrc location=video.mp4 ! decodebin !
    nvvideoconvert !
    video/x-raw(memory:NVMM),format=RGBA !

    nvdsringbuf
        ring-bytes=3898800000   # 90 —Å–ª–æ—Ç–æ–≤ √ó —Ä–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞
        min-slots=90             # 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 30 FPS
        chunk=1 !

    nvvideoconvert ! autovideosink
"""
```

### –ü—Ä–∏–º–µ—Ä —Å –¥–≤—É–º—è –≤–µ—Ç–∫–∞–º–∏ (–ø—Ä—è–º–∞—è + –∑–∞–¥–µ—Ä–∂–∫–∞):
```python
pipeline = """
    videosrc ! ... ! tee name=t

    # –í–µ—Ç–∫–∞ 1: –ü—Ä—è–º–æ–π –ø–æ—Ç–æ–∫
    t. ! queue !
         identity name=direct !
         autovideosink

    # –í–µ—Ç–∫–∞ 2: –° –∑–∞–¥–µ—Ä–∂–∫–æ–π 3 —Å–µ–∫
    t. ! queue !
         nvdsringbuf ring-bytes=X min-slots=90 !
         identity name=delayed !
         autovideosink
"""
```

## üìà –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–µ—Ä–∂–∫–∏

| –ó–∞–¥–µ—Ä–∂–∫–∞ | –°–ª–æ—Ç—ã (30 FPS) | –ü–∞–º—è—Ç—å (5700√ó1900) | –ü–∞–º—è—Ç—å (1920√ó1080) |
|----------|----------------|--------------------|--------------------|
| 1 —Å–µ–∫    | 30             | 1.2 GB            | 0.24 GB           |
| 2 —Å–µ–∫    | 60             | 2.4 GB            | 0.48 GB           |
| **3 —Å–µ–∫**| **90**         | **3.6 GB**        | **0.71 GB**       |
| 4 —Å–µ–∫    | 120            | 4.8 GB            | 0.95 GB           |
| 5 —Å–µ–∫    | 150            | 6.1 GB            | 1.19 GB           |

## üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è

```bash
cd /home/nvidia/deep_cv_football/my_ring_buffer
make clean && make
```

## üìù –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü–ª–∞–≥–∏–Ω –ù–ï passthrough** - –æ–Ω –∞–∫—Ç–∏–≤–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫
2. **–î—Ä–æ–ø–∞–µ—Ç –ø–µ—Ä–≤—ã–µ N –∫–∞–¥—Ä–æ–≤** –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
3. **–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è** –≤—ã–¥–∞—ë—Ç –∫–∞–¥—Ä—ã –∏–∑ —Ö–≤–æ—Å—Ç–∞ –∫–æ–ª—å—Ü–∞
4. **–ó–∞–¥–µ—Ä–∂–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `min-slots`

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–ª–∞–≥–∏–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- ‚úÖ –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å NVMM –ø–∞–º—è—Ç—å—é
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ 173 —Å–ª–æ—Ç–æ–≤ (5.8 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø–∞–º—è—Ç–∏)

---

**–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£**