# Анализ Калибровочных Изображений - Резюме

## Дата анализа
28 октября 2025

## Проблема
При калибровке двух одинаковых камер FSM:GO-IMX678C-M12-L100A-PM-A1Q1 получены разные результаты:
- **Камера 0 (левая)**: RMS = 12.0 пикселей ❌ (ПЛОХО!)
- **Камера 1 (правая)**: RMS = 1.774 пикселей ✓ (Приемлемо)

Нормальный RMS для качественной калибровки: **0.1-0.5 пикселей**

## Анализ выполнен

### Параметры шахматной доски
- Размер: **8x6 внутренних углов**
- Разрешение камер: **3856x2180 пикселей**

### Результаты анализа

#### Камера 0 (левая) - 70 изображений
```
✓ Хорошие изображения:        48 (68.6%)
⚠ Проблемные:                  1 (1.4%)
❌ КРИТИЧЕСКИ плохие:          21 (30.0%)
❌ Доска не найдена:           0 (0.0%)
```

**Средние метрики хороших изображений:**
- Резкость (sharpness): 331.5
- Покрытие кадра: 12.4%
- Ошибка репроекции: **0.205 пикселей** ✓

#### Камера 1 (правая) - 68 изображений
```
✓ Хорошие изображения:        61 (89.7%)
⚠ Проблемные:                  2 (2.9%)
❌ КРИТИЧЕСКИ плохие:          2 (2.9%)
❌ Доска не найдена:           3 (4.4%)
```

**Средние метрики хороших изображений:**
- Резкость (sharpness): 317.4
- Покрытие кадра: 13.1%
- Ошибка репроекции: **0.307 пикселей** ✓

## Найденные проблемы

### Камера 0 (левая) - ГЛАВНАЯ ПРОБЛЕМА
**21 изображение с критическими дефектами:**

**Основная проблема:** Доска слишком маленькая в кадре (< 1% покрытия)
- Файлы: cam0_00062, 00064, 00065, 00066, 00087, 00100, 00127, 00130, 00145, 00147, 00160, 00183, 00189, 00193, 00205, 00207, 00211, 00213, 00216, 00225, 00226

Когда доска занимает менее 1% кадра:
- Углы обнаруживаются с низкой точностью
- Субпиксельное уточнение работает плохо
- Это приводит к ОГРОМНЫМ ошибкам калибровки

**Именно эти 21 изображение портят калибровку камеры 0!**

### Камера 1 (правая)
**5 изображений с проблемами:**
- `cam1_00140.jpg` - Высокая ошибка репроекции (2.37 пикселей)
- `cam1_00256.jpg` - Доска слишком мала (0.1%)
- `cam1_00166.jpg`, `cam1_00211.jpg`, `cam1_00213.jpg` - Доска не найдена

## Рекомендации

### 1. НЕМЕДЛЕННО - Удалить плохие изображения

Выполните:
```bash
chmod +x calibration/cleanup_bad_images.sh
./calibration/cleanup_bad_images.sh
```

Это удалит:
- **Камера 0**: 21 файл
- **Камера 1**: 5 файлов

После очистки останется:
- **Камера 0**: 49 хороших изображений
- **Камера 1**: 63 хороших изображения

### 2. Повторить калибровку

После удаления плохих файлов запустите калибровку заново.

**Ожидаемые результаты:**
- Камера 0 RMS: **< 0.5 пикселей** (вместо 12.0!)
- Камера 1 RMS: **< 0.5 пикселей** (улучшится с 1.774)

### 3. Если нужны дополнительные снимки

Если после очистки изображений недостаточно, сделайте новые:

**Правила качественной съемки:**

✓ **ХОРОШО:**
- Доска занимает **5-40% кадра**
- Четкий фокус (не размыто!)
- Хорошее освещение
- Разные углы наклона доски
- Разные расстояния до камеры
- Покрытие всех зон кадра (углы, края, центр)

❌ **ПЛОХО:**
- Доска < 3% кадра (слишком далеко)
- Доска > 70% кадра (слишком близко)
- Размытые снимки
- Темные или пересвеченные снимки
- Только центральные позиции

## Объяснение высокого RMS

**Почему Камера 0 имела RMS = 12.0 пикселей?**

При калибровке OpenCV пытается найти параметры камеры (матрицу и коэффициенты дисторсии), которые минимизируют ошибку репроекции для ВСЕХ изображений.

Когда в наборе есть изображения с:
- Слишком маленькой доской (< 1% кадра)
- Неточным обнаружением углов

Это создает **противоречивые данные**, и алгоритм не может найти хорошее решение.

21 плохое изображение из 70 = **30% мусора** → Высокий RMS!

**После удаления этих изображений:**
- Останутся только качественные данные
- Алгоритм калибровки найдет точное решение
- RMS упадет до нормальных значений (< 0.5 px)

## Сравнение камер

| Параметр | Камера 0 | Камера 1 |
|----------|----------|----------|
| Всего изображений | 70 | 68 |
| **Хороших** | **48** | **61** |
| Критически плохих | 21 | 2 |
| Средняя ошибка репроекции (хорошие) | 0.205 px | 0.307 px |

**Вывод:** Обе камеры одинакового качества! Проблема только в плохих изображениях.

## Следующие шаги

1. ✅ **Запустить** `./calibration/cleanup_bad_images.sh`
2. ✅ **Повторить калибровку** с очищенным набором
3. ✅ **Проверить RMS** - должен быть < 0.5 для обеих камер
4. ⚠ **Если RMS всё еще высокий** - свяжитесь для дальнейшего анализа

## Файлы анализа

- `calibration/analysis_output.txt` - Полный текстовый отчет
- `calibration/calibration_cleanup_report.json` - Данные в JSON формате
- `calibration/cleanup_bad_images.sh` - Скрипт удаления плохих файлов
- `calibration/simple_calibration_check.py` - Скрипт анализа (можно запустить снова)

## Проверка после очистки

После удаления файлов можно повторно запустить анализ:
```bash
python3 calibration/simple_calibration_check.py
```

Должно показать 0 критически плохих изображений.

---

**Дата:** 2025-10-28
**Анализ выполнен:** Claude Code
**Инструменты:** OpenCV 4.x, Python 3
