# –°–≤–æ–¥–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## üìã –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π pano_cuda_debug_stages.py

–§–∞–π–ª `pano_cuda_debug_stages.py` –æ–∂–∏–¥–∞–µ—Ç **–æ–¥–∏–Ω** –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.pkl` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```python
data = {
    'left_camera': {
        'mtx': np.array 3x3,      # –ú–∞—Ç—Ä–∏—Ü–∞ –∫–∞–º–µ—Ä—ã K0
        'dist': np.array (1,5)    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–∏—Å—Ç–æ—Ä—Å–∏–∏ D0
    },
    'right_camera': {
        'mtx': np.array 3x3,      # –ú–∞—Ç—Ä–∏—Ü–∞ –∫–∞–º–µ—Ä—ã K1
        'dist': np.array (1,5)    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–∏—Å—Ç–æ—Ä—Å–∏–∏ D1
    },
    'stereo': {
        'R': np.array 3x3,        # –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ –º–µ–∂–¥—É –∫–∞–º–µ—Ä–∞–º–∏
        'T': np.array (3,1)       # –í–µ–∫—Ç–æ—Ä —Å–¥–≤–∏–≥–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π)
    }
}
```

### –§—É–Ω–∫—Ü–∏—è load_calibration() (—Å—Ç—Ä–æ–∫–∞ 125)

```python
def load_calibration(pkl="calibration_result_standard.pkl"):
    if not os.path.exists(pkl):
        print(f"[i] PKL '{pkl}' –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –±–µ—Ä—É –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–¥–∞.")
        return K_L,D_L,K_R,D_R,R_LR

    with open(pkl,"rb") as f:
        data = pickle.load(f)

    # –û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
    if 'left_camera' in data and 'right_camera' in data:
        K_L = data['left_camera']['mtx'].astype(np.float64)
        D_L = data['left_camera']['dist'].ravel().astype(np.float64)
        K_R = data['right_camera']['mtx'].astype(np.float64)
        D_R = data['right_camera']['dist'].ravel().astype(np.float64)

        if 'stereo' in data:
            R_LR = data['stereo']['R'].astype(np.float64)
            T_LR = data['stereo']['T'].astype(np.float64)
        else:
            R_LR = np.eye(3, dtype=np.float64)

    # –†—É—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ —Ü–µ–Ω—Ç—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 154-158)
    K_L[1, 2] += 0   # cy –¥–ª—è –ª–µ–≤–æ–π
    K_R[1, 2] += 45  # cy –¥–ª—è –ø—Ä–∞–≤–æ–π
    K_L[0, 2] += 24  # cx –¥–ª—è –ª–µ–≤–æ–π
    K_R[0, 2] += 0   # cx –¥–ª—è –ø—Ä–∞–≤–æ–π

    return K_L,D_L,K_R,D_R,R_LR
```

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–π –∫–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª

### **calibration_result_standard.pkl** ‚úÖ –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –§–ê–ô–õ

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `/home/nvidia/deep_cv_football/calibration_result_standard.pkl` (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞)

**–†–∞–∑–º–µ—Ä:** 1.1 KB

**–§–æ—Ä–º–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å `pano_cuda_debug_stages.py`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```python
{
    'left_camera': {
        'mtx': [[2229.617, 0, 1971.274],
                [0, 2229.518, 1042.003],
                [0, 0, 1]],
        'dist': [-0.327, 0.131, -0.0002, -0.0006, -0.027],
        'rms': 0.180,
        'num_images': 49
    },
    'right_camera': {
        'mtx': [[2233.073, 0, 1972.003],
                [0, 2235.955, 1066.618],
                [0, 0, 1]],
        'dist': [-0.330, 0.138, 0.0002, -0.0004, -0.030],
        'rms': 0.198,
        'num_images': 63
    },
    'stereo': {
        'R': [[0.0275, 0.2366, -0.9711],
              [-0.2447, 0.9435, 0.2230],
              [0.9692, 0.2315, 0.0839]],
        'T': [[-0.706], [0.587], [-0.394]],  # –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π!
        'E': Essential Matrix,
        'F': Fundamental Matrix,
        'angle_deg': 85.19,
        'num_inliers': 54,
        'total_points': 1824,
        'method': 'essential_matrix'
    },
    'metadata': {
        'chessboard_size': (8, 6),
        'square_size_mm': 25.0,
        'camera_model': 'FSM:GO-IMX678C-M12-L100A-PM-A1Q1',
        'fov_deg': 100
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –í main() —Ñ—É–Ω–∫—Ü–∏–∏ pano_cuda_debug_stages.py (—Å—Ç—Ä–æ–∫–∞ 513):
K_L, D_L, K_R, D_R, R_LR = load_calibration("calibration_result_standard.pkl")
```


---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–ª—è —Ä–∞–±–æ—Ç—ã —Å `pano_cuda_debug_stages.py` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**

```bash
# –§–∞–π–ª —É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
python3 old_dev/finlstish/pano_cuda_debug_stages.py
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç `calibration_result_standard.pkl` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.

---

## üìä –ö–∞—á–µ—Å—Ç–≤–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ö–∞–º–µ—Ä–∞ 0 (–ª–µ–≤–∞—è) RMS** | 0.180 px ‚úÖ |
| **–ö–∞–º–µ—Ä–∞ 1 (–ø—Ä–∞–≤–∞—è) RMS** | 0.198 px ‚úÖ |
| **–£–≥–æ–ª –º–µ–∂–¥—É –∫–∞–º–µ—Ä–∞–º–∏** | 85.19¬∞ ‚úÖ |
| **–ò–Ω–ª–∞–µ—Ä–æ–≤ —Å—Ç–µ—Ä–µ–æ** | 54 / 1824 (3.0%) |
| **–ú–µ—Ç–æ–¥ —Å—Ç–µ—Ä–µ–æ** | Essential Matrix + RANSAC |
| **FOV –∫–∞–º–µ—Ä** | 100¬∞ –∫–∞–∂–¥–∞—è |
| **–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ** | ~15¬∞ |

---

## üîß –†—É—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤ pano_cuda_debug_stages.py

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–∫—Ä–∏–ø—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –∫ –æ–ø—Ç–∏—á–µ—Å–∫–∏–º —Ü–µ–Ω—Ç—Ä–∞–º:

```python
# –°—Ç—Ä–æ–∫–∏ 154-158
K_L[1, 2] += 0   # cy –¥–ª—è –ª–µ–≤–æ–π –∫–∞–º–µ—Ä—ã
K_R[1, 2] += 45  # cy –¥–ª—è –ø—Ä–∞–≤–æ–π –∫–∞–º–µ—Ä—ã (+45 –ø–∏–∫—Å–µ–ª–µ–π)
K_L[0, 2] += 24  # cx –¥–ª—è –ª–µ–≤–æ–π –∫–∞–º–µ—Ä—ã (+24 –ø–∏–∫—Å–µ–ª—è)
K_R[0, 2] += 0   # cx –¥–ª—è –ø—Ä–∞–≤–æ–π –∫–∞–º–µ—Ä—ã
```

–≠—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ **–ù–ï –≤–∫–ª—é—á–µ–Ω—ã** –≤ —Ñ–∞–π–ª `.pkl` - –æ–Ω–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥—Ä—É–≥–∏–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏, –∏–∑–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `load_calibration()`.

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–í–µ–∫—Ç–æ—Ä T –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω** - —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞–º–µ—Ä–∞–º–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
2. **Essential Matrix –º–µ—Ç–æ–¥** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑-–∑–∞ —à–∏—Ä–æ–∫–æ–≥–æ —É–≥–ª–∞ (85¬∞)
3. **cv2.stereoCalibrate()** –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–∞–∫–∏—Ö —É–≥–ª–æ–≤ (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ 20¬∞)
4. –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 26 –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
5. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∞—Ö–º–∞—Ç–Ω–∞—è –¥–æ—Å–∫–∞ 8x6 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≥–ª—ã), —Ä–∞–∑–º–µ—Ä –∫–≤–∞–¥—Ä–∞—Ç–∞ 25 –º–º

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**JSON —Ñ–∞–π–ª—ã (–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö):**
- `calibration/calibration_results_cleaned.json` - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
- `calibration/stereo_essential_matrix_results.json` - —Å—Ç–µ—Ä–µ–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞

**–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è:**
- `calibration/create_standard_calibration.py` - —Å–æ–∑–¥–∞–µ—Ç calibration_result_standard.pkl

**–°–∫—Ä–∏–ø—Ç—ã –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏:**
- `calibration/recalibrate_cleaned.py` - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞
- `calibration/stereo_essential_matrix.py` - —Å—Ç–µ—Ä–µ–æ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-28
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
