# –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å

## üîß –í–∏–¥–µ–æ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ ~10 —Å–µ–∫—É–Ω–¥–µ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ vlc, ffplay –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–ª–µ–µ—Ä –≤–∏–¥–µ–æ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥–µ.

### –ü—Ä–∏—á–∏–Ω–∞:
MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø–∏—Å–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (moov atom) –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞. –ü—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Ctrl+C –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏.

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å–∫—Ä–∏–ø—Ç–∞ ‚úÖ

–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `synced_dual_record.py` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
```python
mp4mux faststart=true fragment-duration=1000
```

–≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:
- `faststart=true` - –ø–∏—à–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
- `fragment-duration=1000` - –ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è)

**–ó–∞–ø—É—Å–∫:**
```bash
python3 synced_dual_record.py
```

#### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ–±–∞—Å—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é (qtmux) ‚úÖ‚úÖ

–ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å `qtmux` –≤–º–µ—Å—Ç–æ `mp4mux`:

```bash
python3 synced_dual_record_robust.py
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ qtmux:**
- –°–æ–∑–¥–∞—ë—Ç recovery —Ñ–∞–π–ª—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- Fragment-based –∑–∞–ø–∏—Å—å –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- –ë–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤ –∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º

#### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã üîß

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å "–∑–∞–≤–∏—Å–∞—é—â–∏–µ" —Ñ–∞–π–ª—ã:

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–∏–Ω —Ñ–∞–π–ª
./fix_mp4.sh broken_video.mp4

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
./fix_mp4.sh broken_video.mp4 repaired.mp4

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ MP4 —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
for f in *.mp4; do ./fix_mp4.sh "$f"; done
```

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ffmpeg –¥–ª—è –ø–µ—Ä–µ–º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ö–æ–ø–∏—Ä—É–µ—Ç –≤–∏–¥–µ–æ –±–µ–∑ –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (–±—ã—Å—Ç—Ä–æ)
- –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç MP4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –î–æ–±–∞–≤–ª—è–µ—Ç `faststart` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

---

## üé¨ Hardware sync –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–∏–º–ø—Ç–æ–º—ã:
- –†–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞ > 5 –∫–∞–¥—Ä–æ–≤
- V4L2 controls –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –Ω–æ sync –ø–ª–æ—Ö–æ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∏:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ V4L2 controls
```bash
v4l2-ctl -d /dev/video0 -C operation_mode,synchronizing_function
v4l2-ctl -d /dev/video1 -C operation_mode,synchronizing_function
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
video0: operation_mode=0 (Master), synchronizing_function=1 (Internal Sync)
video1: operation_mode=1 (Slave), synchronizing_function=2 (External Sync)
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ sync –ø—Ä–æ–≤–æ–¥
- –§–∏–∑–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –º–µ–∂–¥—É sync –ø–∏–Ω–∞–º–∏ –∫–∞–º–µ—Ä?
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–ª—è—Ä–Ω–æ—Å—Ç—å?
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ?

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–∞–¥—Ä–æ–≤
```bash
python3 check_frame_sync.py camera_master_*.mp4 camera_slave_*.mp4
```

–°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ "–†–∞–∑–Ω–∏—Ü–∞ PTS –ø–µ—Ä–≤–æ–≥–æ –∫–∞–¥—Ä–∞" - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 33–º—Å (< 1 –∫–∞–¥—Ä –ø—Ä–∏ 30fps)

---

## üìä –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–∞–¥—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞:
Master –∏ slave –∏–º–µ—é—Ç —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ –≤ —Ñ–∞–π–ª–∞—Ö.

### –ü—Ä–∏—á–∏–Ω–∞:
–û–¥–∏–Ω –∏–∑ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–æ–≥–æ.

### –†–µ—à–µ–Ω–∏–µ:
1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç** - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±–µ –∫–∞–º–µ—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ qtmux** - –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –æ—Ç –æ–¥–Ω–æ–π –∏–∑ –∫–∞–º–µ—Ä?

---

## ‚ö° –ù–∏–∑–∫–∏–π FPS / –ø—Ä–æ–ø—É—Å–∫–∏ –∫–∞–¥—Ä–æ–≤

### –ü—Ä–∏—á–∏–Ω–∞:
–°–∏—Å—Ç–µ–º–∞ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞ 4K –ø–æ—Ç–æ–∫–∞.

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∂–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
sudo nvpmodel -m 0
sudo jetson_clocks
```

#### 2. –°–Ω–∏–∑—å—Ç–µ –±–∏—Ç—Ä–µ–π—Ç
```bash
python3 synced_dual_record.py --bitrate 20  # –≤–º–µ—Å—Ç–æ 25
```

#### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ H.265 (–ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ)
```bash
python3 synced_dual_record.py --codec h265
```

---

## üî¥ –û—à–∏–±–∫–∏ "Cannot capture"

### –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:
```
GST_ARGUS: Cannot capture
```

### –ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

#### 1. –ö–∞–º–µ—Ä—ã –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–∞–º–µ—Ä—ã
sudo lsof | grep /dev/video

# –£–±–µ–π—Ç–µ –∏—Ö
sudo pkill -f nvarguscamerasrc
```

#### 2. –ù–µ–≤–µ—Ä–Ω—ã–π sensor-id
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞–º–µ—Ä—ã
ls /dev/video*
v4l2-ctl --list-devices

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ID
python3 synced_dual_record.py --master 0 --slave 1
```

#### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–∞–º–µ—Ä—ã
```bash
# –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç reset
./reset_cameras.sh

# –ò–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
sudo reboot
```

---

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:

```bash
# 1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å)
ffprobe -v error -select_streams v:0 -count_packets \
  -show_entries stream=nb_read_packets -of csv=p=0 camera_master_*.mp4

ffprobe -v error -select_streams v:0 -count_packets \
  -show_entries stream=nb_read_packets -of csv=p=0 camera_slave_*.mp4

# 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–¥—Ä–æ–≤
python3 check_frame_sync.py camera_master_*.mp4 camera_slave_*.mp4

# 3. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
vlc camera_master_*.mp4  # –î–æ–ª–∂–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –¥–æ –∫–æ–Ω—Ü–∞
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é

- [ ] Sync –ø—Ä–æ–≤–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω –º–µ–∂–¥—É –∫–∞–º–µ—Ä–∞–º–∏
- [ ] V4L2 controls –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (operation_mode, synchronizing_function)
- [ ] –†–µ–∂–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: `sudo nvpmodel -m 0`
- [ ] –ö–∞–º–µ—Ä—ã –Ω–µ –∑–∞–Ω—è—Ç—ã –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- [ ] –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å `faststart=true`

---

## üÜò –í—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–°–æ–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
   ```bash
   # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
   uname -a
   nvpmodel -q

   # –ö–∞–º–µ—Ä—ã
   v4l2-ctl --list-devices
   v4l2-ctl -d /dev/video0 --all

   # –¢–µ—Å—Ç –æ–¥–Ω–æ–π –∫–∞–º–µ—Ä—ã
   gst-launch-1.0 nvarguscamerasrc sensor-id=0 sensor-mode=0 \
     ! fakesink
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞
   - –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã `check_frame_sync.py`

3. **–û—Ç–∫—Ä–æ–π—Ç–µ issue:**
   - –ü—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–æ–≥–∏
   - –û–ø–∏—à–∏—Ç–µ —à–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –£–∫–∞–∂–∏—Ç–µ –º–æ–¥–µ–ª—å –∫–∞–º–µ—Ä (IMX678/IMX477)
