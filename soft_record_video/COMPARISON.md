# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä

## –ü—Ä–æ–±–ª–µ–º–∞ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–¥–µ

**–§–∞–π–ª:** `new_dual_record.py`, —Å—Ç—Ä–æ–∫–∏ 155-171

```python
# ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
self.pipeline_left.set_state(Gst.State.PLAYING)
time.sleep(0.5)  # ‚Üê 500 –º—Å –∑–∞–¥–µ—Ä–∂–∫–∏!
self.pipeline_right.set_state(Gst.State.PLAYING)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- IMX477: —Ä–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞ ~0.5 —Å–µ–∫—É–Ω–¥—ã
- IMX678: —Ä–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞ ~11 –∫–∞–¥—Ä–æ–≤ (367 –º—Å –ø—Ä–∏ 30fps)

## –ú–µ—Ç–æ–¥—ã —Ä–µ—à–µ–Ω–∏—è

### 1. Hardware Sync (–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–¢–æ—á–Ω–æ—Å—Ç—å:** < 1 –∫–∞–¥—Ä–∞ (< 33 –º—Å –ø—Ä–∏ 30fps)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –§–∏–∑–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–æ–¥ –º–µ–∂–¥—É sync –ø–∏–Ω–∞–º–∏ –∫–∞–º–µ—Ä
- –ú–∞—Å—Ç–µ—Ä-–∫–∞–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç sync –∏–º–ø—É–ª—å—Å—ã
- –°–ª–µ–π–≤-–∫–∞–º–µ—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ –∏–º–ø—É–ª—å—Å–∞–º
- –ö–∞–¥—Ä—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ–Ω—Å–æ—Ä–∞

**V4L2 –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –ú–∞—Å—Ç–µ—Ä (video0)
v4l2-ctl -d /dev/video0 -c operation_mode=0 -c synchronizing_function=1

# –°–ª–µ–π–≤ (video1)
v4l2-ctl -d /dev/video1 -c operation_mode=1 -c synchronizing_function=2
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ –ª—é–±–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–≤–æ–¥–∞
- ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏ (IMX678, IMX477)

---

### 2. PAUSED ‚Üí PLAYING (–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

**–¢–æ—á–Ω–æ—Å—Ç—å:** 1-3 –∫–∞–¥—Ä–∞ (33-100 –º—Å)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ PAUSED, –ø–æ—Ç–æ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç
pipeline_left.set_state(Gst.State.PAUSED)
pipeline_right.set_state(Gst.State.PAUSED)

# –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
pipeline_left.get_state(Gst.CLOCK_TIME_NONE)
pipeline_right.get_state(Gst.CLOCK_TIME_NONE)

# –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç –ë–ï–ó –∑–∞–¥–µ—Ä–∂–∫–∏
pipeline_left.set_state(Gst.State.PLAYING)
pipeline_right.set_state(Gst.State.PLAYING)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –í—Å–µ –µ—â–µ –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

---

### 3. Shared Clock (–£–ª—É—á—à–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

**–¢–æ—á–Ω–æ—Å—Ç—å:** –£–ª—É—á—à–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ 10-20%

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –û–±—â–∏–µ —á–∞—Å—ã –¥–ª—è –æ–±–æ–∏—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
base_clock = Gst.SystemClock.obtain()
pipeline_left.use_clock(base_clock)
pipeline_right.use_clock(base_clock)

# –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è
base_time = base_clock.get_time()
pipeline_left.set_base_time(base_time)
pipeline_right.set_base_time(base_time)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç timestamps –≤ –±—É—Ñ–µ—Ä–∞—Ö
- ‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º —Å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∑–∞–¥–µ—Ä–∂–∫–∏ —Å—Ç–∞—Ä—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

### 4. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ (–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

**–¢–æ—á–Ω–æ—Å—Ç—å:** –£–ª—É—á—à–µ–Ω–∏–µ ~0.5 —Å–µ–∫—É–Ω–¥—ã

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```python
# ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: –£–±–∏—Ä–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
pipeline_left.set_state(Gst.State.PLAYING)
# –ù–ï–¢ time.sleep()!
pipeline_right.set_state(Gst.State.PLAYING)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- ‚úÖ –õ—É—á—à–µ —á–µ–º –Ω–∏—á–µ–≥–æ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –í—Å–µ –µ—â–µ –µ—Å—Ç—å —Ä–∞–∑–Ω–∏—Ü–∞ –∏–∑-–∑–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–º–µ—Ä

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è

**–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ –º–µ—Ç–æ–¥—ã –≤–º–µ—Å—Ç–µ:**

```python
# 1. Hardware sync —á–µ—Ä–µ–∑ V4L2
setup_hardware_sync()

# 2. –û–±—â–∏–µ —á–∞—Å—ã
base_clock = Gst.SystemClock.obtain()
pipeline_master.use_clock(base_clock)
pipeline_slave.use_clock(base_clock)

# 3. PAUSED ‚Üí PLAYING
pipeline_master.set_state(Gst.State.PAUSED)
pipeline_slave.set_state(Gst.State.PAUSED)
pipeline_master.get_state(Gst.CLOCK_TIME_NONE)
pipeline_slave.get_state(Gst.CLOCK_TIME_NONE)

# 4. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç
pipeline_master.set_state(Gst.State.PLAYING)
pipeline_slave.set_state(Gst.State.PLAYING)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** < 1 –∫–∞–¥—Ä–∞ —Ä–∞–∑–Ω–∏—Ü—ã

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ú–µ—Ç–æ–¥ | –¢–æ—á–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|-------|----------|-----------|------------|
| –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ | ~11 –∫–∞–¥—Ä–æ–≤ | –ü—Ä–æ—Å—Ç–æ–π | - |
| –¢–æ–ª—å–∫–æ —É–±—Ä–∞—Ç—å sleep | ~5-8 –∫–∞–¥—Ä–æ–≤ | –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π | - |
| PAUSED ‚Üí PLAYING | 1-3 –∫–∞–¥—Ä–∞ | –°—Ä–µ–¥–Ω—è—è | - |
| + Shared Clock | 1-2 –∫–∞–¥—Ä–∞ | –°—Ä–µ–¥–Ω—è—è | - |
| + Hardware Sync | < 1 –∫–∞–¥—Ä–∞ | –°—Ä–µ–¥–Ω—è—è | Sync –ø—Ä–æ–≤–æ–¥ |

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –° hardware sync (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
python3 synced_dual_record.py
```

### –ë–µ–∑ hardware sync
```bash
python3 synced_dual_record.py --no-hardware-sync
```

### –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
```bash
python3 new_dual_record.py
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:

```
[INFO] üîÑ –ê–Ω–∞–ª–∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
[INFO] ‚è±Ô∏è –†–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞: 12.45–º—Å
[INFO] üéûÔ∏è –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–∞–¥—Ä–∞—Ö: ~0.4 –∫–∞–¥—Ä–æ–≤
[INFO] ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è! (< 1 –∫–∞–¥—Ä–∞)
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ –≤ —Ñ–∞–π–ª–∞—Ö
ffprobe -v error -select_streams v:0 -count_packets \
  -show_entries stream=nb_read_packets -of csv=p=0 camera_master_*.mp4

ffprobe -v error -select_streams v:0 -count_packets \
  -show_entries stream=nb_read_packets -of csv=p=0 camera_slave_*.mp4
```

–†–∞–∑–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 0-1 –∫–∞–¥—Ä!
