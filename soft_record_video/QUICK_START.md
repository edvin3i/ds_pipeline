# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å IMX678

## üöÄ –ó–∞–ø—É—Å–∫ —Å hardware sync (–¥–ª—è IMX678)

```bash
cd /home/nvidia/deep_cv_football/soft_record_video

# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python3 synced_dual_record.py

# –†–æ–±–∞—Å—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∞—é—Ç –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏)
python3 synced_dual_record_robust.py
```

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- ‚úÖ Hardware sync –≤–∫–ª—é—á–µ–Ω (master/slave —á–µ—Ä–µ–∑ V4L2)
- ‚úÖ Sensor mode = 0 (–ë–ï–ó HDR –¥–ª—è IMX678)
- ‚úÖ H.264 –∫–æ–¥–µ–∫
- ‚úÖ 25 –ú–±–∏—Ç/—Å –Ω–∞ –∫–∞–º–µ—Ä—É
- ‚úÖ –û–±—â–∏–µ —á–∞—Å—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

## üìù –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

1. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç V4L2 controls:**
   ```bash
   v4l2-ctl -d /dev/video0 -c operation_mode=0 -c synchronizing_function=1  # Master
   v4l2-ctl -d /dev/video1 -c operation_mode=1 -c synchronizing_function=2  # Slave
   ```

2. **–°–æ–∑–¥–∞—ë—Ç GStreamer –ø–∞–π–ø–ª–∞–π–Ω—ã —Å:**
   - `sensor-mode=0` (–±–µ–∑ HDR)
   - `do-timestamp=true` (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è timestamps)
   - –û–±—â–∏–π SystemClock

3. **–ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–∞–º–µ—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:**
   - PAUSED (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è) ‚Üí PLAYING (–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

4. **–ò–∑–º–µ—Ä—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:**
   - –†–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
   - –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–∞–¥—Ä–∞—Ö

---

## üîß –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞

### –î–ª—è IMX678 –±–µ–∑ HDR (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
```bash
python3 synced_dual_record.py
```

### –° H.265 –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º –±–∏—Ç—Ä–µ–π—Ç–æ–º
```bash
python3 synced_dual_record.py --codec h265 --bitrate 35
```

### –ï—Å–ª–∏ sync –ø—Ä–æ–≤–æ–¥ –ù–ï –ø–æ–¥–∫–ª—é—á–µ–Ω
```bash
python3 synced_dual_record.py --no-hardware-sync
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å HDR —Ä–µ–∂–∏–º–æ–º
```bash
python3 synced_dual_record.py --sensor-mode 1
```

---

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞

–ù–∞–∂–º–∏—Ç–µ **Ctrl+C**

–°–∫—Ä–∏–ø—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –æ–±–µ –∫–∞–º–µ—Ä—ã –∏ –ø–æ–∫–∞–∂–µ—Ç –∞–Ω–∞–ª–∏–∑:
```
[INFO] üìä –ê–Ω–∞–ª–∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
[INFO] ‚è±Ô∏è –†–∞–∑–Ω–∏—Ü–∞ —Å—Ç–∞—Ä—Ç–∞: 12.33–º—Å
[INFO] üéûÔ∏è –†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–∞–¥—Ä–∞—Ö: ~0.4 –∫–∞–¥—Ä–æ–≤
[INFO] ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è! (< 1 –∫–∞–¥—Ä–∞)
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–§–∞–π–ª—ã:**
- `camera_master_YYYYMMDD_HHMMSS.mp4`
- `camera_slave_YYYYMMDD_HHMMSS.mp4`

**–û–∂–∏–¥–∞–µ–º–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- –° hardware sync: **< 1 –∫–∞–¥—Ä–∞** (~33–º—Å –ø—Ä–∏ 30fps)
- –ë–µ–∑ hardware sync: **1-3 –∫–∞–¥—Ä–∞** (~33-100–º—Å)

---

## ‚öôÔ∏è –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------------------|----------|
| `--master` | 0 | ID –º–∞—Å—Ç–µ—Ä-–∫–∞–º–µ—Ä—ã |
| `--slave` | 1 | ID —Å–ª–µ–π–≤-–∫–∞–º–µ—Ä—ã |
| `--codec` | h264 | –ö–æ–¥–µ–∫ (h264/h265) |
| `--bitrate` | 25 | –ë–∏—Ç—Ä–µ–π—Ç –≤ –ú–±–∏—Ç/—Å |
| `--sensor-mode` | 0 | –†–µ–∂–∏–º —Å–µ–Ω—Å–æ—Ä–∞ (0=–±–µ–∑ HDR) |
| `--no-hardware-sync` | - | –û—Ç–∫–ª—é—á–∏—Ç—å V4L2 sync |
| `--no-shared-clock` | - | –û—Ç–∫–ª—é—á–∏—Ç—å –æ–±—â–∏–µ —á–∞—Å—ã |

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä
vlc camera_master_*.mp4

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤ (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å)
ffprobe -v error -select_streams v:0 -count_packets \
  -show_entries stream=nb_read_packets -of csv=p=0 camera_master_*.mp4

# –°–∫–ª–µ–π–∫–∞ side-by-side
ffmpeg -i camera_master_*.mp4 -i camera_slave_*.mp4 \
  -filter_complex hstack output.mp4
```

---

## ‚ùì –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Hardware sync –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–∞–º–µ—Ä–∞–º–∏
v4l2-ctl -d /dev/video0 --list-ctrls | grep operation

# –ï—Å–ª–∏ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
python3 synced_dual_record.py --no-hardware-sync
```

### –ö–∞–º–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ
ls -l /dev/video0 /dev/video1

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø –∫–∞–º–µ—Ä
v4l2-ctl -d /dev/video0 --all | grep "Card type"
```

### –û—à–∏–±–∫–∏ GStreamer
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ permissions
sudo usermod -a -G video $USER
# –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ nvarguscamerasrc —Ä–∞–±–æ—Ç–∞–µ—Ç
gst-launch-1.0 nvarguscamerasrc sensor-id=0 sensor-mode=0 ! fakesink
```

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ sync –ø—Ä–æ–≤–æ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω –º–µ–∂–¥—É –∫–∞–º–µ—Ä–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/dev/video0` –∏ `/dev/video1`

2. **–î–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ H.265: `--codec h265`
   - –ü–æ–≤—ã—Å—å—Ç–µ –±–∏—Ç—Ä–µ–π—Ç: `--bitrate 35`

3. **–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ hardware sync (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –ù–µ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ shared clock
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sensor-mode=0

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –≤—ã–≤–æ–¥ "–†–∞–∑–Ω–∏—Ü–∞ –≤ –∫–∞–¥—Ä–∞—Ö"
   - < 1 –∫–∞–¥—Ä–∞ = –æ—Ç–ª–∏—á–Ω–æ
   - 1-3 –∫–∞–¥—Ä–∞ = —Ö–æ—Ä–æ—à–æ
   - > 5 –∫–∞–¥—Ä–æ–≤ = –ø—Ä–æ–±–ª–µ–º–∞ —Å sync –ø—Ä–æ–≤–æ–¥–æ–º

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [SYNC_README.md](SYNC_README.md) - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- [COMPARISON.md](COMPARISON.md) - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `python3 synced_dual_record.py --help` - —Å–ø—Ä–∞–≤–∫–∞
