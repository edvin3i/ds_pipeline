# Руководство по настройке FOV

## Как работает система зума

### Два параметра управления:

1. **ball_radius** (клавиши Q/E)
   - Диапазон: 5-60 пикселей
   - Влияет на `base_fov`
   - Формула: `base_fov = 30.0 + (radius - 5.0) × 0.95`

2. **target_ball_size** (клавиши Z/X)
   - Диапазон: 0.03-0.15
   - Влияет на `zoom_factor`
   - Формула: `zoom_factor = 0.055 / target_ball_size`

### Финальный FOV:
```
target_fov = CLAMP(base_fov × zoom_factor, 40°, 120°)
```

---

## Таблица значений

### Влияние ball_radius на base_fov (при target_ball_size=0.055):

| Radius (px) | base_fov | zoom_factor | Финальный FOV |
|-------------|----------|-------------|---------------|
| 5           | 30.0°    | 1.0         | 40.0° (min)   |
| 10          | 34.75°   | 1.0         | 40.0° (min)   |
| 20          | 44.25°   | 1.0         | 44.25°        |
| 30          | 53.75°   | 1.0         | 53.75°        |
| 40          | 63.25°   | 1.0         | 63.25°        |
| 50          | 72.75°   | 1.0         | 72.75°        |
| 60          | 82.25°   | 1.0         | 82.25°        |

### Влияние target_ball_size на zoom_factor (при radius=20px, base_fov=44.25°):

| target_ball_size | zoom_factor | Финальный FOV |
|------------------|-------------|---------------|
| 0.03             | 1.833       | 81.13°        |
| 0.04             | 1.375       | 60.84°        |
| 0.055 (default)  | 1.0         | 44.25°        |
| 0.07             | 0.786       | 40.0° (min)   |
| 0.10             | 0.55        | 40.0° (min)   |
| 0.15             | 0.367       | 40.0° (min)   |

---

## Рекомендации по настройке

### Для широкого обзора поля:
- **ball_radius**: 40-60px (E несколько раз)
- **target_ball_size**: 0.03-0.04 (Z несколько раз)
- **Ожидаемый FOV**: 80-120°

### Для детального просмотра мяча:
- **ball_radius**: 5-10px (Q несколько раз)
- **target_ball_size**: 0.10-0.15 (X несколько раз)
- **Ожидаемый FOV**: 40-45°

### Для среднего обзора:
- **ball_radius**: 20px (default)
- **target_ball_size**: 0.055 (default)
- **Ожидаемый FOV**: 44-50°

---

## Где изменить лимиты

### 1. Максимальный FOV (в файле `src/nvdsvirtualcam_config.h`):
```cpp
constexpr float FOV_MAX = 120.0f;  // Измените это значение
```

### 2. Лимит радиуса мяча (в файле `src/gstnvdsvirtualcam.cpp`, строка ~1264):
```cpp
gfloat radius = CLAMP(vcam->ball_actual_radius, 5.0f, 100.0f);  // Второй параметр - max
```

### 3. Формула расчёта base_fov (там же, строка ~1265):
```cpp
gfloat base_fov = 30.0f + (radius - 5.0f) * 0.95f;
// Коэффициент 0.95 определяет скорость роста FOV
```

После изменений: `cd src && make`

---

## Мониторинг в реальном времени

При запуске `test_virtual_camera_keyboard.py` вы увидите:

```
⚽ Ball: (2850, 950) | ~Yaw: 0.0° | ~Pitch: 5.0° | Radius: 20.0px | FOV: 44.3° | Target size: 0.055 | Updates: 42
```

**Наблюдайте за полем FOV** и экспериментируйте с клавишами Q/E и Z/X для поиска оптимального значения!
