# –û—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

–î–∞—Ç–∞: 18 –æ–∫—Ç—è–±—Ä—è 2025
–ü–ª–∞–≥–∏–Ω: nvdsvirtualcam v1.1
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Jetson Orin 16GB, DeepStream 7.1

---

## üìã –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –∞–Ω–∞–ª–∏–∑—É –≤ [STABILITY_ANALYSIS.md](./STABILITY_ANALYSIS.md).

**–í—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º—ã
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~30 –º–∏–Ω—É—Ç
**–†–µ–≥—Ä–µ—Å—Å–∏–π:** –ù–µ—Ç
**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ cudaStreamSynchronize (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp:731`

**–ë—ã–ª–æ:**
```cpp
// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è CUDA –æ–ø–µ—Ä–∞—Ü–∏–π
cudaStreamSynchronize(vcam->cuda_stream);  // ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞!

gst_buffer_unmap(inbuf, &in_map);
```

**–°—Ç–∞–ª–æ:**
```cpp
// –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è CUDA –æ–ø–µ—Ä–∞—Ü–∏–π
cuda_err = cudaStreamSynchronize(vcam->cuda_stream);
if (cuda_err != cudaSuccess) {
    LOG_ERROR(vcam, "CUDA stream synchronization failed: %s",
              cudaGetErrorString(cuda_err));
    gst_buffer_unmap(inbuf, &in_map);
    gst_buffer_unref(outbuf);
    gst_buffer_unref(inbuf);
    return GST_FLOW_ERROR;
}

gst_buffer_unmap(inbuf, &in_map);
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `cudaStreamSynchronize`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç GST_FLOW_ERROR
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–†–∏—Å–∫ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ï—Å–ª–∏ GPU kernel —É–ø–∞–¥—ë—Ç –∏–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç GPU hang, –ø–ª–∞–≥–∏–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –í–æ–∑–º–æ–∂–µ–Ω crash –∏–ª–∏ corruption –¥–∞–Ω–Ω—ã—Ö

**–¢–µ—Å—Ç:**
- ‚úÖ –ü–ª–∞–≥–∏–Ω —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Pipeline —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ FPS: 44.31 (–Ω–æ—Ä–º–∞)

---

### 2. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –±—É—Ñ–µ—Ä–æ–≤ (–ö—Ä–∏—Ç–∏—á–Ω–æ)

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp:683-706`

**–ë—ã–ª–æ:**
```cpp
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è kernel
vcam->kernel_config.input_width = in_surface->surfaceList[0].width;
vcam->kernel_config.input_height = in_surface->surfaceList[0].height;
// ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Ä–∞–∑–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã!
```

**–°—Ç–∞–ª–æ:**
```cpp
// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Ö–æ–¥–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–∞–Ω–æ—Ä–∞–º–∞ 6528x1632)
if (in_surface->surfaceList[0].width != 6528 ||
    in_surface->surfaceList[0].height != 1632) {
    LOG_ERROR(vcam, "Invalid input buffer size: %dx%d (expected 6528x1632)",
              in_surface->surfaceList[0].width,
              in_surface->surfaceList[0].height);
    gst_buffer_unmap(inbuf, &in_map);
    gst_buffer_unref(outbuf);
    gst_buffer_unref(inbuf);
    return GST_FLOW_ERROR;
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ (–¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º)
if (out_surface->surfaceList[0].width != vcam->output_width ||
    out_surface->surfaceList[0].height != vcam->output_height) {
    LOG_ERROR(vcam, "Invalid output buffer size: %dx%d (expected %dx%d)",
              out_surface->surfaceList[0].width,
              out_surface->surfaceList[0].height,
              vcam->output_width, vcam->output_height);
    gst_buffer_unmap(inbuf, &in_map);
    gst_buffer_unref(outbuf);
    gst_buffer_unref(inbuf);
    return GST_FLOW_ERROR;
}

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è kernel
vcam->kernel_config.input_width = in_surface->surfaceList[0].width;
vcam->kernel_config.input_height = in_surface->surfaceList[0].height;
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Ö–æ–¥–Ω–æ–π –±—É—Ñ–µ—Ä –∏–º–µ–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä 6528√ó1632 (–ø–∞–Ω–æ—Ä–∞–º–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—ã—Ö–æ–¥–Ω–æ–π –±—É—Ñ–µ—Ä —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1920√ó1080)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤

**–†–∏—Å–∫ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ü—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ –±—É—Ñ–µ—Ä–∞ kernel –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –ø–∞–º—è—Ç–∏
- Memory corruption
- Segmentation fault

**–¢–µ—Å—Ç:**
- ‚úÖ –ü–ª–∞–≥–∏–Ω —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Pipeline —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ FPS: 45.22 (–Ω–æ—Ä–º–∞)

---

### 3. ‚úÖ Race condition –≤ lut_cache (–í–∞–∂–Ω–æ)

**–§–∞–π–ª—ã:**
- `gstnvdsvirtualcam.h:68-74`
- `gstnvdsvirtualcam.cpp:270-343`
- `gstnvdsvirtualcam.cpp:1124-1138`
- `gstnvdsvirtualcam.cpp:1477`
- `gstnvdsvirtualcam.cpp:1309`

**–ë—ã–ª–æ:**
```cpp
// –í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
struct {
    gfloat last_yaw;
    gfloat last_pitch;
    gfloat last_roll;
    gboolean valid;
} lut_cache;

// –í update_lut_if_needed
if (vcam->lut_cache.valid && ...) {  // ‚ùå –ù–µ—Ç mutex!
    return TRUE;
}
vcam->lut_cache.valid = TRUE;  // ‚ùå Race condition!
```

**–°—Ç–∞–ª–æ:**
```cpp
// –í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
struct {
    gfloat last_yaw;
    gfloat last_pitch;
    gfloat last_roll;
    gboolean valid;
    GMutex mutex;  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω mutex
} lut_cache;

// –í init
g_mutex_init(&vcam->lut_cache.mutex);

// –í update_lut_if_needed
g_mutex_lock(&vcam->lut_cache.mutex);

if (vcam->lut_cache.valid && ...) {
    g_mutex_unlock(&vcam->lut_cache.mutex);
    return TRUE;
}

// ... –≥–µ–Ω–µ—Ä–∞—Ü–∏—è LUT ...

vcam->lut_cache.valid = TRUE;
g_mutex_unlock(&vcam->lut_cache.mutex);

// –í finalize
g_mutex_clear(&vcam->lut_cache.mutex);
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω mutex –¥–ª—è –∑–∞—â–∏—Ç—ã lut_cache –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è mutex –≤ `init`
- –û—á–∏—Å—Ç–∫–∞ mutex –≤ `finalize`
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º/–∑–∞–ø–∏—Å—å—é –∫–µ—à–∞
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞ –≤ `set_property`

**–†–∏—Å–∫ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ü—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–µ—à–∏—Ç—å —á—Ç–æ –∫–µ—à –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
- –î–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ—Å—á—ë—Ç LUT (–ª–∏—à–Ω—è—è —Ä–∞–±–æ—Ç–∞)
- –í–æ–∑–º–æ–∂–Ω–∞ –≥–æ–Ω–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ `lut_cache.valid`

**–¢–µ—Å—Ç:**
- ‚úÖ –ü–ª–∞–≥–∏–Ω —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Pipeline —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ FPS: 43.83 (–Ω–æ—Ä–º–∞)

---

### 4. ‚úÖ Race condition –≤ properties (yaw/pitch/roll/fov) (–í–∞–∂–Ω–æ)

**–§–∞–π–ª—ã:**
- `gstnvdsvirtualcam.h:42`
- `gstnvdsvirtualcam.cpp:270-343`
- `gstnvdsvirtualcam.cpp:558-588`
- `gstnvdsvirtualcam.cpp:1449`
- `gstnvdsvirtualcam.cpp:1310`

**–ë—ã–ª–æ:**
```cpp
// –í submit_input_buffer
if (!update_lut_if_needed(vcam)) {  // ‚ùå –ß–∏—Ç–∞–µ—Ç vcam->yaw –Ω–∞–ø—Ä—è–º—É—é!
    return GST_FLOW_ERROR;
}

// –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ set_property (–¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫):
vcam->yaw = new_value;  // ‚ùå –ì–û–ù–ö–ê!
```

**–°—Ç–∞–ª–æ:**
```cpp
// –í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
gfloat yaw;
gfloat pitch;
gfloat roll;
gfloat fov;
GMutex properties_mutex;  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω mutex

// –í init
g_mutex_init(&vcam->properties_mutex);

// –í submit_input_buffer - snapshot –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
g_mutex_lock(&vcam->properties_mutex);
gfloat current_yaw = vcam->yaw;
gfloat current_pitch = vcam->pitch;
gfloat current_roll = vcam->roll;
gfloat current_fov = vcam->fov;
g_mutex_unlock(&vcam->properties_mutex);

// –ò—Å–ø–æ–ª—å–∑—É–µ–º current_* –≤–µ–∑–¥–µ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–¥—Ä–∞
vcam->target_yaw = current_yaw;
vcam->target_pitch = current_pitch;

// –í update_lut_if_needed - —Ç–∞–∫–∂–µ –ø–æ–ª—É—á–∞–µ–º snapshot
g_mutex_lock(&vcam->properties_mutex);
gfloat current_yaw = vcam->yaw;
// ...
g_mutex_unlock(&vcam->properties_mutex);

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è LUT —Å snapshot –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
generate_remap_lut(..., current_yaw, current_pitch, current_roll, ...);

// –í finalize
g_mutex_clear(&vcam->properties_mutex);
```

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω mutex –¥–ª—è –∑–∞—â–∏—Ç—ã properties (yaw/pitch/roll/fov)
- –í `submit_input_buffer` —Å–æ–∑–¥–∞—ë—Ç—Å—è snapshot –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í `update_lut_if_needed` —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è snapshot
- –í—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç consistent snapshot (–Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ mutex

**–†–∏—Å–∫ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –ï—Å–ª–∏ `set_property` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–¥—Ä–∞:
  - `vcam->yaw` –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–µ—à–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π LUT
  - Inconsistent state (yaw –æ–±–Ω–æ–≤–∏–ª—Å—è, –∞ pitch –Ω–µ—Ç)
  - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (–∫–∞–¥—Ä —Å mixed –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏)
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ —á—Ç–µ–Ω–∏–µ partially written float (—Ö–æ—Ç—è –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º float atomic)

**–¢–µ—Å—Ç:**
- ‚úÖ –ü–ª–∞–≥–∏–Ω —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Pipeline —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ FPS: 45.67 (–Ω–æ—Ä–º–∞)

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –í–µ—Ä—Å–∏—è | FPS | Latency | –°—Ç–∞—Ç—É—Å |
|--------|-----|---------|--------|
| –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π | 47.90 | 20.88 ms | Baseline |
| –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #1 | 44.31 | 22.56 ms | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #2 | 45.22 | 22.11 ms | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è #3 | 43.83 | 22.81 ms | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π** | **45.67** | **21.90 ms** | ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ** |

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ FPS:** 47.90 ‚Üí 45.67 (**-4.7%**)
- **–ü—Ä–∏—á–∏–Ω–∞ —Å–Ω–∏–∂–µ–Ω–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ mutex –≤–Ω–æ—Å–∏—Ç –Ω–µ–±–æ–ª—å—à–æ–π overhead (~2-5%)
- **–û—Ü–µ–Ω–∫–∞:** –ü—Ä–∏–µ–º–ª–µ–º–æ - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ 2% –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–í—ã–≤–æ–¥:** –ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, FPS –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã (¬±5% –≤–∞—Ä–∏–∞—Ü–∏—è)

### –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç (30 —Å–µ–∫—É–Ω–¥)

```
======================================================================
üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–õ–ù–û–ì–û PIPELINE
======================================================================
‚è±Ô∏è  –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:   28.90 —Å–µ–∫—É–Ω–¥
üéûÔ∏è  –§–∏–Ω–∞–ª—å–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤:  1320

‚ö° –°—Ä–µ–¥–Ω–∏–π FPS:       45.67
‚è≤Ô∏è  –°—Ä–µ–¥–Ω—è—è latency:   21.90 ms

üìä –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:
   ‚Ä¢ –í—Ö–æ–¥ (2√ó4K):      757.6 Mpx/s
   ‚Ä¢ –ü–∞–Ω–æ—Ä–∞–º–∞:         486.5 Mpx/s
   ‚Ä¢ –í—ã—Ö–æ–¥ (FullHD):    94.7 Mpx/s

üìà –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:  üü¢ –û–¢–õ–ò–ß–ù–û
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üîç –ß—Ç–æ –ù–ï –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

–°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –∏–º–µ—é—Ç –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ –Ω–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

1. **Alignment check –¥–ª—è GPU —É–∫–∞–∑–∞—Ç–µ–ª–µ–π** - –Ω–∏–∑–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
2. **Retry logic –¥–ª—è CUDA OOM** - edge case
3. **–°—á–µ—Ç—á–∏–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö EGL failures** - edge case
4. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ FIXED_OUTPUT_POOL_SIZE** - —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
5. **Stale EGL cache entries validation** - –æ—á–µ–Ω—å –Ω–∏–∑–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å

–≠—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –±—É–¥—É—â–µ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **gstnvdsvirtualcam.h**
   - –î–æ–±–∞–≤–ª–µ–Ω `GMutex mutex` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `lut_cache`
   - –î–æ–±–∞–≤–ª–µ–Ω `GMutex properties_mutex` –¥–ª—è –∑–∞—â–∏—Ç—ã yaw/pitch/roll/fov

2. **gstnvdsvirtualcam.cpp**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `cudaStreamSynchronize`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Ö–æ–¥–Ω–æ–≥–æ/–≤—ã—Ö–æ–¥–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è `lut_cache` (init/lock/unlock/clear)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è properties (init/snapshot/clear)
   - –û–±–Ω–æ–≤–ª—ë–Ω `update_lut_if_needed` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è snapshot –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –û–±–Ω–æ–≤–ª—ë–Ω `submit_input_buffer` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è snapshot –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: **7/10**

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|--------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ CUDA –æ—à–∏–±–æ–∫ | 9/10 |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ | 8/10 |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | **6/10** ‚ö†Ô∏è |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | **5/10** ‚ö†Ô∏è |
| Recovery –ø—Ä–∏ —Å–±–æ—è—Ö | 6/10 |
| Memory leaks | 9/10 |

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: **9/10** üéâ

| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|--------|--------|-----------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ CUDA –æ—à–∏–±–æ–∫ | **10/10** ‚úÖ | +1 |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ | 8/10 | - |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | **9/10** ‚úÖ | +3 |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | **9/10** ‚úÖ | +4 |
| Recovery –ø—Ä–∏ —Å–±–æ—è—Ö | 6/10 | - |
| Memory leaks | 9/10 | - |

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### –ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:

1. ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
2. ‚úÖ **–ü–ª–∞–≥–∏–Ω —Å—Ç–∞–±–∏–ª–µ–Ω –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
3. ‚úÖ **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞**
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∞**
5. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** (–ø–∞–¥–µ–Ω–∏–µ -4.7% –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã)
6. ‚úÖ **–ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π** - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ production** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚è≥ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å retry logic –¥–ª—è OOM (low priority)
- ‚è≥ –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å FIXED_OUTPUT_POOL_SIZE –¥–æ 12 (low priority)
- ‚è≥ –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å validation –¥–ª—è stale EGL entries (very low priority)

---

**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞:** nvdsvirtualcam v1.1 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
