# NvDsVirtualCam Plugin - Virtual Camera from Panorama

–ü–ª–∞–≥–∏–Ω GStreamer –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã –∏–∑ –ø–∞–Ω–æ—Ä–∞–º–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º–∏ —É–≥–ª–∞–º–∏ –æ–±–∑–æ—Ä–∞ (yaw, pitch, roll, FOV).

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
my_virt_cam/
‚îú‚îÄ‚îÄ src/                                    # –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsvirtualcam.cpp              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsvirtualcam.h                # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsvirtualcam_allocator.cpp    # –ê–ª–ª–æ–∫–∞—Ç–æ—Ä –±—É—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsvirtualcam_allocator.h
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsbufferpool.h
‚îÇ   ‚îú‚îÄ‚îÄ cuda_virtual_cam_kernel.cu         # CUDA —è–¥—Ä–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ cuda_virtual_cam_kernel.h
‚îÇ   ‚îú‚îÄ‚îÄ nvdsvirtualcam_config.h            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ nvds_ball_meta.h                   # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –º—è—á–∞
‚îÇ   ‚îî‚îÄ‚îÄ Makefile                           # Makefile –¥–ª—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ libnvdsvirtualcam.so                   # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω
‚îú‚îÄ‚îÄ test_virtualcam_fps.py                 # –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ dynamic_camera.py                      # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–∞–º–µ—Ä–∞
‚îú‚îÄ‚îÄ show_virtualcam_correct.py             # –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
‚îú‚îÄ‚îÄ test_virtual_cam_with_ball.py          # –¢–µ—Å—Ç —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –º—è—á–∞
‚îú‚îÄ‚îÄ pano_equirect.png                      # –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∞–Ω–æ—Ä–∞–º–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ README.md                              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–±–æ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

```bash
cd /home/nvidia/deep_cv_football/my_virt_cam/src
make clean
make
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
cd /home/nvidia/deep_cv_football/my_virt_cam

# –¢–µ—Å—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º (30 —Å–µ–∫—É–Ω–¥, —Ü–µ–Ω—Ç—Ä –ø–∞–Ω–æ—Ä–∞–º—ã)
python3 test_virtualcam_fps.py pano_equirect.png

# –¢–µ—Å—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–∞–º–µ—Ä—ã
python3 test_virtualcam_fps.py pano_equirect.png --yaw=30 --pitch=10 --fov=55

# –î–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç (60 —Å–µ–∫—É–Ω–¥)
python3 test_virtualcam_fps.py pano_equirect.png --duration=60

# –¢–µ—Å—Ç —Å –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–º
python3 test_virtualcam_fps.py panorama_video.mp4 --yaw=0 --pitch=15
```

## üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–≥–∏–Ω–∞

### –£–≥–ª—ã –∫–∞–º–µ—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –î–∏–∞–ø–∞–∑–æ–Ω | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|----------|--------------|
| **yaw** | –ü–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ | -90¬∞ –¥–æ +90¬∞ | 0¬∞ |
| **pitch** | –ù–∞–∫–ª–æ–Ω –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑ | -30¬∞ –¥–æ +20¬∞ | 0¬∞ |
| **roll** | –ù–∞–∫–ª–æ–Ω –≤–±–æ–∫ | -23¬∞ –¥–æ +23¬∞ | 0¬∞ |
| **fov** | –£–≥–æ–ª –æ–±–∑–æ—Ä–∞ –∫–∞–º–µ—Ä—ã | 40¬∞ –¥–æ 65¬∞ | 50¬∞ |

### –í—ã—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| **output-width** | –®–∏—Ä–∏–Ω–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ | 1920 |
| **output-height** | –í—ã—Å–æ—Ç–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ | 1080 |

### –ê–≤—Ç–æ—Å–ª–µ–∂–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| **auto-follow** | –°–ª–µ–¥–∏—Ç—å –∑–∞ –æ–±—ä–µ–∫—Ç–æ–º | false |
| **smooth-factor** | –ü–ª–∞–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (0.0-1.0) | 0.3 |

## üìê –§–æ—Ä–º–∞—Ç –ø–∞–Ω–æ—Ä–∞–º—ã

–ü–ª–∞–≥–∏–Ω –æ–∂–∏–¥–∞–µ—Ç –ø–∞–Ω–æ—Ä–∞–º—É –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** 6528√ó1632 –ø–∏–∫—Å–µ–ª–µ–π
- **–§–æ—Ä–º–∞—Ç:** RGBA (NVMM memory)
- **–ü—Ä–æ–µ–∫—Ü–∏—è:** –≠–∫–≤–∏—Ä–µ–∫—Ç–∞–Ω–≥—É–ª—è—Ä–Ω–∞—è (equirectangular)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** 180¬∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ √ó 50¬∞ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
  - –î–æ–ª–≥–æ—Ç–∞ (longitude): -90¬∞ –¥–æ +90¬∞
  - –®–∏—Ä–æ—Ç–∞ (latitude): -30¬∞ –¥–æ +20¬∞

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** | 6528√ó1632 (Panorama) |
| **–í—ã—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** | 1920√ó1080 (Full HD) |
| **–¶–µ–ª–µ–≤–æ–π FPS** | 50+ FPS |
| **GPU –ø–∞–º—è—Ç—å** | ~200-300 MB |

### –§–∞–∫—Ç–æ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **FOV (—É–≥–æ–ª –æ–±–∑–æ—Ä–∞)** - –±–æ–ª—å—à–∏–π FOV = –±–æ–ª—å—à–µ –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **–í—ã—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** - –≤—ã—à–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ = –±–æ–ª—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–≥–ª–æ–≤** - —á–∞—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å—á—ë—Ç–∞ LUT –∫–∞—Ä—Ç

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### test_virtualcam_fps.py
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º FPS –∏ latency.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 test_virtualcam_fps.py <panorama> [options]

–û–ø—Ü–∏–∏:
  --yaw=N      - —É–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ (-90 –¥–æ +90)
  --pitch=N    - —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ (-30 –¥–æ +20)
  --fov=N      - —É–≥–æ–ª –æ–±–∑–æ—Ä–∞ (40-65)
  --duration=N - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞
```

**–í—ã–≤–æ–¥–∏—Ç:**
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π FPS –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –°—Ä–µ–¥–Ω–∏–π FPS –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
- –°—Ä–µ–¥–Ω—é—é latency (ms)
- –û—Ü–µ–Ω–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Throughput (Mpx/s)

### dynamic_camera.py
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–≥–ª–æ–≤ –∫–∞–º–µ—Ä—ã.

### show_virtualcam_correct.py
–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

### test_virtual_cam_with_ball.py
–¢–µ—Å—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ (–º—è—á–∞) –Ω–∞ –ø–∞–Ω–æ—Ä–∞–º–µ.

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–≥–∏–Ω

### 1. –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–ü–ª–∞–≥–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –ø–∞–Ω–æ—Ä–∞–º–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ NVMM (GPU –ø–∞–º—è—Ç—å).

### 2. CUDA –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –í—ã—á–∏—Å–ª—è—é—Ç—Å—è –ª—É—á–∏ –∫–∞–º–µ—Ä—ã (ray casting) –Ω–∞ –æ—Å–Ω–æ–≤–µ FOV
- –°–æ–∑–¥–∞—é—Ç—Å—è LUT –∫–∞—Ä—Ç—ã (remap_u, remap_v) –¥–ª—è —Ç–µ–∫—É—â–∏—Ö —É–≥–ª–æ–≤
- CUDA kernel –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∏–∫—Å–µ–ª–∏ –∏–∑ –ø–∞–Ω–æ—Ä–∞–º—ã –ø–æ LUT –∫–∞—Ä—Ç–∞–º
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –¥–ª—è —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ LUT –∫–∞—Ä—Ç** - –ø–µ—Ä–µ—Å—á—ë—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–≥–ª–æ–≤
- **–ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ª—É—á–∏** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ FOV
- **Fixed buffer pool** - 8 –±—É—Ñ–µ—Ä–æ–≤ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è round-robin
- **CUDA stream** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU

### 4. –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ 1920√ó1080 –≤ —Ñ–æ—Ä–º–∞—Ç–µ RGBA (NVMM).

## üìñ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π pipeline

```bash
gst-launch-1.0 \
  filesrc location=panorama.mp4 ! qtdemux ! h264parse ! nvv4l2decoder ! \
  nvvideoconvert ! video/x-raw(memory:NVMM),format=RGBA,width=6528,height=1632 ! \
  nvdsvirtualcam yaw=0 pitch=0 roll=0 fov=50 ! \
  nvvideoconvert ! autovideosink
```

### Pipeline —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —É–≥–ª–æ–≤

```python
import gi
gi.require_version('Gst', '1.0')
from gi.repository import Gst, GLib

# –°–æ–∑–¥–∞—Ç—å pipeline
pipeline = Gst.parse_launch("""
    filesrc location=panorama.mp4 ! qtdemux ! h264parse ! nvv4l2decoder !
    nvvideoconvert ! video/x-raw(memory:NVMM),format=RGBA,width=6528,height=1632 !
    nvdsvirtualcam name=vcam yaw=0 pitch=0 roll=0 fov=50 !
    nvvideoconvert ! autovideosink
""")

# –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
vcam = pipeline.get_by_name("vcam")

# –ò–∑–º–µ–Ω–∏—Ç—å —É–≥–æ–ª –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
vcam.set_property("yaw", 30.0)
vcam.set_property("pitch", 10.0)
vcam.set_property("fov", 55.0)
```

### Pipeline —Å –∞–≤—Ç–æ—Å–ª–µ–∂–µ–Ω–∏–µ–º –∑–∞ –æ–±—ä–µ–∫—Ç–æ–º

```bash
gst-launch-1.0 \
  filesrc location=panorama.mp4 ! qtdemux ! h264parse ! nvv4l2decoder ! \
  nvvideoconvert ! video/x-raw(memory:NVMM),format=RGBA,width=6528,height=1632 ! \
  nvdsvirtualcam yaw=0 pitch=0 fov=50 auto-follow=true smooth-factor=0.3 ! \
  nvvideoconvert ! autovideosink
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ê–≤—Ç–æ—Å–ª–µ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞ –≤ NvDsMeta.

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ CUDA —è–¥—Ä–∞

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/cuda_virtual_cam_kernel.cu`
2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `cd src && make`
3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ: `python3 test_virtualcam_fps.py pano_equirect.png`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–º–µ—Ä—ã

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/nvdsvirtualcam_config.h`
2. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (FOV_MIN, FOV_MAX, YAW_MIN, YAW_MAX –∏ —Ç.–¥.)
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `cd src && make`

### CUDA block size

–í `src/nvdsvirtualcam_config.h`:
```cpp
constexpr int BLOCK_SIZE_X = 32;  // –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω 32 (warp size)
constexpr int BLOCK_SIZE_Y = 16;
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–ª–∞–≥–∏–Ω –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ stdout:
```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
GST_DEBUG=nvdsvirtualcam:5 python3 test_virtualcam_fps.py pano_equirect.png

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
GST_DEBUG=nvdsvirtualcam:3 python3 test_virtualcam_fps.py pano_equirect.png
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞–Ω–æ—Ä–∞–º—ã:** 6528√ó1632
2. **–¢—Ä–µ–±—É–µ—Ç—Å—è NVMM –ø–∞–º—è—Ç—å:** –í—Ö–æ–¥–Ω—ã–µ –±—É—Ñ–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GPU –ø–∞–º—è—Ç–∏
3. **–ß–∞—Å—Ç–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É–≥–ª–æ–≤:** –ü–µ—Ä–µ—Å—á—ë—Ç LUT –∫–∞—Ä—Ç –∑–∞–Ω–∏–º–∞–µ—Ç ~1-2ms
4. **Edge safety:** –ü—Ä–∏ –±–æ–ª—å—à–∏—Ö FOV –∏ –∫—Ä–∞–π–Ω–∏—Ö —É–≥–ª–∞—Ö –≤–æ–∑–º–æ–∂–Ω—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

## üêõ Troubleshooting

### –ü–ª–∞–≥–∏–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd src
make check-libs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
make check-symbols

# –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
make debug
```

### –ù–∏–∑–∫–∏–π FPS
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É GPU: `sudo tegrastats`
2. –£–º–µ–Ω—å—à–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: `output-width=1280 output-height=720`
3. –£–º–µ–Ω—å—à–∏—Ç–µ FOV: `fov=45`

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –ø–∞–Ω–æ—Ä–∞–º—ã (6528√ó1632)
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É–≥–ª—ã –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (pitch –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω 32)

## üìù –í–µ—Ä—Å–∏—è

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **v1.0**
- CUDA block size: 32√ó16
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Å–ª–µ–∂–µ–Ω–∏—è –∑–∞ –æ–±—ä–µ–∫—Ç–∞–º–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ LUT –∫–∞—Ä—Ç—ã
- Fixed buffer pool (8 –±—É—Ñ–µ—Ä–æ–≤)

## üéØ –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ pipeline

–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –æ–±–æ–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤:

```bash
cd /home/nvidia/deep_cv_football/my_virt_cam
python3 test_full_pipeline.py left.mp4 right.mp4 --duration=30
```

**–ü–æ–ª–Ω—ã–π pipeline:**
```
2√ó4K –≤–∏–¥–µ–æ ‚Üí nvdsstitch ‚Üí –ü–∞–Ω–æ—Ä–∞–º–∞ 6528√ó1632 ‚Üí nvdsvirtualcam ‚Üí FullHD 1920√ó1080
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:**
- ‚ö° FPS: **47.90** (–æ—Ç–ª–∏—á–Ω–æ!)
- ‚è≤Ô∏è Latency: 20.88 ms
- üìä –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 794.5 Mpx/s (–≤—Ö–æ–¥) ‚Üí 99.3 Mpx/s (–≤—ã—Ö–æ–¥)

–ü–ª–∞–≥–∏–Ω –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ–ª–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º pipeline!

---

## üî¨ –ê–Ω–∞–ª–∏–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≤—ã—è—Å–Ω–∏–ª–æ—Å—å:

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –û–∂–∏–¥–∞–Ω–∏–µ | –†–µ–∞–ª—å–Ω–æ—Å—Ç—å |
|-------------|----------|------------|
| cudaStreamSync —É–¥–∞–ª–∏—Ç—å | +10-20% | +0.1% |
| Block size 32√ó16 | +5-15% | **-8.5%** ‚ùå |
| Block size 32√ó8 | +5-15% | **-7.4%** ‚ùå |
| –£–¥–∞–ª–µ–Ω–∏–µ debug | +1-2% | **-5.3%** ‚ùå |

**–í—ã–≤–æ–¥:** –ü–ª–∞–≥–∏–Ω —É–∂–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (block size 16√ó16)!

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –≤:
- [OPTIMIZATION_ANALYSIS.md](./OPTIMIZATION_ANALYSIS.md) - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- [OPTIMIZATION_RESULTS.md](./OPTIMIZATION_RESULTS.md) - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [PERFORMANCE_TEST_RESULTS.md](./PERFORMANCE_TEST_RESULTS.md) - –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

---

## üõ°Ô∏è –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

–ü—Ä–æ–≤–µ–¥—ë–Ω –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–¥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö.

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

- –û—Ç–ª–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CUDA –æ—à–∏–±–æ–∫ –ø—Ä–∏ allocation
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ cleanup
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏ (EGL cache, fixed pool)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ cudaStreamSynchronize** - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ crash –ø—Ä–∏ GPU error
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –±—É—Ñ–µ—Ä–æ–≤** - —Ä–∏—Å–∫ memory corruption
3. **Race conditions –≤ lut_cache** - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–∞–¥—Ä—ã –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
4. **Race conditions –≤ properties** - –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

### üìä –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: ~~**7/10**~~ ‚Üí **9/10** ‚úÖ

~~–ü–ª–∞–≥–∏–Ω —Å—Ç–∞–±–∏–ª–µ–Ω –¥–ª—è normal operation, –Ω–æ —É—è–∑–≤–∏–º –∫ edge cases.~~

**–û–ë–ù–û–í–õ–ï–ù–ò–ï:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [STABILITY_ANALYSIS.md](./STABILITY_ANALYSIS.md) - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- [STABILITY_FIXES.md](./STABILITY_FIXES.md) - –û—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ cudaStreamSynchronize** - –∑–∞—â–∏—Ç–∞ –æ—Ç GPU errors
2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –±—É—Ñ–µ—Ä–æ–≤** - –∑–∞—â–∏—Ç–∞ –æ—Ç memory corruption
3. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω mutex –¥–ª—è lut_cache** - –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
4. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω mutex –¥–ª—è properties** - –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 45.67 FPS (—Å—Ç–∞–±–∏–ª—å–Ω–æ)

