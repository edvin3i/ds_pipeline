# –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–Ω–æ—Ä–∞–º—ã –∏ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–∞—à–µ–π –ø–∞–Ω–æ—Ä–∞–º—ã

–£ –≤–∞—Å **–ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞—è –ø–∞–Ω–æ—Ä–∞–º–∞** - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ—Å–æ–±—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

### –ü–∏–∫—Å–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏):
```
Y = 0              ‚Üê –í–ï–†–• –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
Y = 950 (—Ü–µ–Ω—Ç—Ä)
Y = 1900           ‚Üê –ù–ò–ó –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
```

### –£–≥–ª–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ):
```
pitch = +22¬∞       ‚Üê –í–ï–†–• –ø–æ–ª—è (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
pitch = -5¬∞ (—Ü–µ–Ω—Ç—Ä)
pitch = -32¬∞       ‚Üê –ù–ò–ó –ø–æ–ª—è (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
```

### –ú–∞–ø–ø–∏–Ω–≥ Y ‚Üí pitch (–ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç—ã–π):
```
Y –º–∞–ª–æ–µ  ‚Üí pitch –±–æ–ª—å—à–æ–π  (y=0    ‚Üí +22¬∞)
Y –±–æ–ª—å—à–æ–µ ‚Üí pitch –º–∞–ª—ã–π   (y=1900 ‚Üí -32¬∞)
```

---

## –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞:

–í —Ñ—É–Ω–∫—Ü–∏–∏ `pano_xy_to_yaw_pitch` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å **—Å—Ç–∞—Ä—ã–µ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
```cpp
const gfloat LAT_MIN = 30.0f;   // –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
const gfloat LAT_MAX = -20.0f;  // –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

–ê –≤ –∫–æ–Ω—Ñ–∏–≥–µ –±—ã–ª–∏ **–Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**:
```cpp
LAT_MIN = -32.0f  // –ù–ò–ó –ø–æ–ª—è
LAT_MAX = +22.0f  // –í–ï–†–• –ø–æ–ª—è
```

**–ò–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º—è—á–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

### –†–µ—à–µ–Ω–∏–µ:

–¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—è `pano_xy_to_yaw_pitch` **–±–µ—Ä—ë—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞**:
```cpp
const gfloat LAT_MIN = NvdsVirtualCamConfig::LAT_MAX;  // +22¬∞ (–í–ï–†–•)
const gfloat LAT_MAX = NvdsVirtualCamConfig::LAT_MIN;  // -32¬∞ (–ù–ò–ó)
```

**–í–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∏–Ω–≤–µ—Ä—Å–∏—é!**
- `LAT_MIN` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ = `LAT_MAX` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- `LAT_MAX` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ = `LAT_MIN` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

–≠—Ç–æ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ** –ø–æ—Ç–æ–º—É —á—Ç–æ:
- Y=0 (–≤–µ—Ä—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –¥–æ–ª–∂–µ–Ω –º–∞–ø–∏—Ç—å—Å—è –≤ pitch=+22¬∞ (–≤–µ—Ä—Ö –ø–æ–ª—è)
- Y=1900 (–Ω–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –¥–æ–ª–∂–µ–Ω –º–∞–ø–∏—Ç—å—Å—è –≤ pitch=-32¬∞ (–Ω–∏–∑ –ø–æ–ª—è)

---

## –§–æ—Ä–º—É–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∞—è —Ñ–æ—Ä–º—É–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 131 –≤ gstnvdsvirtualcam.cpp):
```cpp
*out_pitch = LAT_MIN - (y / (gfloat)(pano_h - 1)) * (LAT_MIN - LAT_MAX);
```

### –ü–æ–¥—Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏—è:
```cpp
pitch = +22¬∞ - (y / 1899) √ó (+22¬∞ - (-32¬∞))
pitch = +22¬∞ - (y / 1899) √ó 54¬∞
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
- **y = 0** (–≤–µ—Ä—Ö):  `pitch = +22¬∞ - 0 = +22¬∞` ‚úÖ
- **y = 950** (—Ü–µ–Ω—Ç—Ä): `pitch = +22¬∞ - 0.5√ó54¬∞ = -5¬∞` ‚úÖ
- **y = 1900** (–Ω–∏–∑): `pitch = +22¬∞ - 1√ó54¬∞ = -32¬∞` ‚úÖ

–í—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéØ

---

## –ü–æ—á–µ–º—É –ø–∞–Ω–æ—Ä–∞–º–∞ –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–ö–∞–º–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤–≤–µ—Ä—Ö –Ω–æ–≥–∞–º–∏**
   - –§–∏–∑–∏—á–µ—Å–∫–∏ –∫–∞–º–µ—Ä—ã —Å–º–æ—Ç—Ä—è—Ç —Å –ø–æ—Ç–æ–ª–∫–∞
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–Ω–∏–º–∞–µ—Ç—Å—è –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç—ã–º

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ**
   - Stitching –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

3. **–ö–æ–Ω–≤–µ–Ω—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**
   - –í –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–º –∑—Ä–µ–Ω–∏–∏ Y —á–∞—Å—Ç–æ —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑
   - –í —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ pitch —Ä–∞—Å—Ç—ë—Ç –≤–≤–µ—Ä—Ö
   - –ù—É–∂–Ω–∞ –∏–Ω–≤–µ—Ä—Å–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞

---

## –ö–∞–∫ —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–¥

### 1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (pano_xy_to_yaw_pitch)
```cpp
// Y —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑ (0 ‚Üí 1900)
// pitch —Ä–∞—Å—Ç—ë—Ç –≤–≤–µ—Ä—Ö (-32¬∞ ‚Üí +22¬∞)
// –ù—É–∂–Ω–∞ –ò–ù–í–ï–†–°–ò–Ø!
pitch = LAT_MIN - (y / h) √ó (LAT_MIN - LAT_MAX)
```

### 2. –ì—Ä–∞–Ω–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (apply_edge_safe_limits)
```cpp
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç pitch –Ω–∞–ø—Ä—è–º—É—é
// –ì—Ä–∞–Ω–∏—Ü—ã: -32¬∞ (–Ω–∏–∑) –¥–æ +22¬∞ (–≤–µ—Ä—Ö)
pitch_min = LAT_MIN + half_fov_v
pitch_max = LAT_MAX - half_fov_v
```

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—è—á–æ–º (test_virtual_camera_keyboard.py)
```python
# W - –≤–≤–µ—Ä—Ö
self.ball_y -= speed  # Y –£–ú–ï–ù–¨–®–ê–ï–¢–°–Ø (–∫ 0)

# S - –≤–Ω–∏–∑
self.ball_y += speed  # Y –£–í–ï–õ–ò–ß–ò–í–ê–ï–¢–°–Ø (–∫ 1900)
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü

### –§–∞–π–ª: src/nvdsvirtualcam_config.h

```cpp
// –ì—Ä–∞–Ω–∏—Ü—ã –ø–∞–Ω–æ—Ä–∞–º—ã –≤ —É–≥–ª–∞—Ö
constexpr float LON_MIN = -90.0f;   // –õ–µ–≤—ã–π –∫—Ä–∞–π
constexpr float LON_MAX = +90.0f;   // –ü—Ä–∞–≤—ã–π –∫—Ä–∞–π
constexpr float LAT_MIN = -32.0f;   // –ù–ò–ñ–ù–ò–ô –∫—Ä–∞–π (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
constexpr float LAT_MAX = +22.0f;   // –í–ï–†–•–ù–ò–ô –∫—Ä–∞–π (—Ñ–∏–∑–∏—á–µ—Å–∫–∏)
```

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º –∫–∞–∫ —Å—à–∏—Ç–∞ –ø–∞–Ω–æ—Ä–∞–º–∞!

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º—è—á –≤ —Ü–µ–Ω—Ç—Ä (R)
3. –ö–∞–º–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ü–µ–Ω—Ç—Ä –ø–æ–ª—è
4. –ù–∞–∂–º–∏—Ç–µ W (–≤–≤–µ—Ä—Ö) - –∫–∞–º–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–∫–ª–æ–Ω—è—Ç—å—Å—è –≤–≤–µ—Ä—Ö
5. –ù–∞–∂–º–∏—Ç–µ S (–≤–Ω–∏–∑) - –∫–∞–º–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–∫–ª–æ–Ω—è—Ç—å—Å—è –≤–Ω–∏–∑

–ï—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ - –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ—Ä–Ω–æ! ‚úÖ

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –ø–ª–∞–≥–∏–Ω!

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
```bash
./rebuild.sh
```

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é
```bash
cd src
make clean && make
```

### –°–ø–æ—Å–æ–± 3: –¢–æ–ª—å–∫–æ –∫–æ–º–ø–∏–ª—è—Ü–∏—è (–±—ã—Å—Ç—Ä–µ–µ)
```bash
cd src
make
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å `make clean && make` —á—Ç–æ–±—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å!

---

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–∏–º–ø—Ç–æ–º: W/S –Ω–µ –¥–≤–∏–≥–∞—é—Ç –∫–∞–º–µ—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ü–ª–∞–≥–∏–Ω –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π?
   ```bash
   stat -c "%y" src/libnvdsvirtualcam.so
   ```

2. –ì—Ä–∞–Ω–∏—Ü—ã –≤ `pano_xy_to_yaw_pitch` –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞?
   ```bash
   grep "LAT_MIN.*NvdsVirtualCamConfig" src/gstnvdsvirtualcam.cpp
   ```

3. –¢–µ—Å—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é?
   - –ó–∞–∫—Ä–æ–π—Ç–µ —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ

### –°–∏–º–ø—Ç–æ–º: –ö–∞–º–µ—Ä–∞ –¥–≤–∏–≥–∞–µ—Ç—Å—è –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ì—Ä–∞–Ω–∏—Ü—ã LAT_MIN/LAT_MAX –ø–µ—Ä–µ–ø—É—Ç–∞–Ω—ã
2. –§–æ—Ä–º—É–ª–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
3. –ü–∞–Ω–æ—Ä–∞–º–∞ –∏–º–µ–µ—Ç –¥—Ä—É–≥—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ LAT_MIN –∏ LAT_MAX –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É –Ω–∞: `pitch = LAT_MAX + ...`

### –°–∏–º–ø—Ç–æ–º: –î–≤–∏–∂–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º –º–∞–ª—ã

**–ü—Ä–∏—á–∏–Ω–∞:** –ì—Ä–∞–Ω–∏—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±—Ä–µ–∑–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –ø—Ä–∏ –±–æ–ª—å—à–æ–º FOV

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ FOV (–∫–ª–∞–≤–∏—à–∞ Q)
- –ò–ª–∏ —É–º–µ–Ω—å—à–∏—Ç–µ MARGIN –≤ –∫–æ–¥–µ

---

## –ò—Ç–æ–≥

‚úÖ **–í–∞—à–∞ –ø–∞–Ω–æ—Ä–∞–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**
‚úÖ **–ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞ Y ‚Üí pitch**
‚úÖ **–í—Å–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞**
‚úÖ **–ü–ª–∞–≥–∏–Ω –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞**

**–¢–µ–ø–µ—Ä—å –¥–≤–∏–∂–µ–Ω–∏–µ W/S –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** üöÄ
