# –ê–Ω–∞–ª–∏–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ nvdsvirtualcam

–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 18 –æ–∫—Ç—è–±—Ä—è 2025
–¢–µ–∫—É—â–∏–π FPS –≤ pipeline: 47.90 FPS

---

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. ‚ùå –ö–†–ò–¢–ò–ß–ù–û: Nearest Neighbor –≤–º–µ—Å—Ç–æ –±–∏–ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏

**–§–∞–π–ª:** `cuda_virtual_cam_kernel.cu`, —Å—Ç—Ä–æ–∫–∞ 198-259

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cuda
// Nearest neighbor (–±–µ–∑ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞)
int src_x = (int)(u + 0.5f);
int src_y = (int)(v + 0.5f);
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **nearest neighbor** –≤–º–µ—Å—Ç–æ –±–∏–ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏! –≠—Ç–æ:
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (–º–µ–Ω—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π)
- ‚ùå –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏—è)
- ‚ùå –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –±–∏–ª–∏–Ω–µ–π–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞. –≠—Ç–æ —Å–Ω–∏–∑–∏—Ç FPS –Ω–∞ ~5-10%, –Ω–æ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô (–≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ)

---

### 2. ‚ö†Ô∏è Block size –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω (16√ó16)

**–§–∞–π–ª:** `cuda_virtual_cam_kernel.cu`, —Å—Ç—Ä–æ–∫–∏ 54, 169, 304

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cuda
dim3 block(16, 16);  // 256 threads
```

–¢–µ–∫—É—â–∏–π block size: **16√ó16 = 256 threads**

–î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –ø–ª–∞–≥–∏–Ω —Å—Ç–∏—á–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **32√ó8 = 256 threads** –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è:
- 32 –ø–æ—Ç–æ–∫–∞ –≤ X = 1 warp = –∏–¥–µ–∞–ª—å–Ω—ã–π memory coalescing
- –ú–µ–Ω—å—à–µ warp divergence

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ **32√ó16 = 512 threads** –∏–ª–∏ **32√ó8 = 256 threads** –¥–ª—è –ª—É—á—à–µ–≥–æ memory coalescing.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°–†–ï–î–ù–ò–ô (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª +5-15% FPS)

---

### 3. ‚ö†Ô∏è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ kernel (—Å—Ç—Ä–æ–∫–∞ 330)

**–§–∞–π–ª:** `cuda_virtual_cam_kernel.cu`, —Å—Ç—Ä–æ–∫–∞ 330

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cuda
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
cudaStreamSynchronize(stream);
```

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ **–∫–∞–∂–¥–æ–≥–æ** –≤—ã–∑–æ–≤–∞ kernel –±–ª–æ–∫–∏—Ä—É–µ—Ç CPU –∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç GPU —Ä–∞–±–æ—Ç–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–±—Ä–∞—Ç—å `cudaStreamSynchronize(stream)` –∏–∑ production –∫–æ–¥–∞ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è debug —Ä–µ–∂–∏–º–∞).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª +10-20% FPS)

---

### 4. ‚ö†Ô∏è –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ printf –≤ kernel (—Å—Ç—Ä–æ–∫–∏ 251-258, 288-290)

**–§–∞–π–ª:** `cuda_virtual_cam_kernel.cu`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cuda
if ((x == out_width/2 && y == out_height/2) ||
    (x == 0 && y == 0) ||
    (x == out_width-1 && y == out_height-1)) {
    // printf("Remap[%d,%d]: u=%.1f,v=%.1f -> src=(%d,%d) -> color=(%d,%d,%d,%d)\n",
    //        x, y, u, v, src_x, src_y,
    //        output[out_idx + 0], output[out_idx + 1],
    //        output[out_idx + 2], output[out_idx + 3]);
}
```

–î–∞–∂–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, —ç—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–∫–∞–∂–¥—ã–º –ø–æ—Ç–æ–∫–æ–º** –Ω–∞ **–∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ**!

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–±—Ä–∞—Ç—å –≤—Å–µ debug –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ production –∫–æ–¥–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `#ifdef DEBUG`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô (–≤–ª–∏—è–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ, –Ω–æ –∫–æ–¥ —á–∏—â–µ)

---

### 5. ‚úÖ –•–û–†–û–®–û: LUT –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp`, —Å—Ç—Ä–æ–∫–∏ 271-328

```cpp
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å LUT
if (vcam->lut_cache.valid &&
    std::fabs(vcam->lut_cache.last_yaw - vcam->yaw) < ANGLE_CHANGE_THRESHOLD &&
    std::fabs(vcam->lut_cache.last_pitch - vcam->pitch) < ANGLE_CHANGE_THRESHOLD &&
    std::fabs(vcam->lut_cache.last_roll - vcam->roll) < ANGLE_CHANGE_THRESHOLD) {
    return TRUE;  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç!
}
```

LUT –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–≥–ª–æ–≤** –±–æ–ª—å—à–µ –ø–æ—Ä–æ–≥–∞ (0.1¬∞). –û—Ç–ª–∏—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è!

---

### 6. ‚úÖ –•–û–†–û–®–û: –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ camera rays

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp`, —Å—Ç—Ä–æ–∫–∏ 282-299

```cpp
// –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª—è–µ–º –ª—É—á–∏ –∫–∞–º–µ—Ä—ã –µ—Å–ª–∏ FOV –∏–∑–º–µ–Ω–∏–ª—Å—è
if (!vcam->rays_computed || std::fabs(vcam->last_fov - vcam->fov) > 0.1f) {
    cudaError_t err = precompute_camera_rays(...);
    vcam->rays_computed = TRUE;
}
```

Camera rays –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ FOV. –•–æ—Ä–æ—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è!

---

### 7. ‚ö†Ô∏è EGL –∫—ç—à - –≥–ª–æ–±–∞–ª—å–Ω—ã–π mutex –º–æ–∂–µ—Ç –±—ã—Ç—å bottleneck

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp`, —Å—Ç—Ä–æ–∫–∏ 342-349

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cpp
// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–µ—à –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –±—É—Ñ–µ—Ä–æ–≤ (—Ç–∞–∫ –∫–∞–∫ –∏—Ö –º–∞–ª–æ - –æ–±—ã—á–Ω–æ 4-6)
static std::unordered_map<void*, EGLCacheEntry> g_egl_cache;
static GMutex g_egl_cache_mutex;
```

–ì–ª–æ–±–∞–ª—å–Ω—ã–π mutex –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å contention –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø–ª–∞–≥–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å per-instance –∫—ç—à –∏–ª–∏ lock-free —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö)

---

### 8. ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ smooth_camera_tracking

**–§–∞–π–ª:** `gstnvdsvirtualcam.cpp`, —Å—Ç—Ä–æ–∫–∏ 131-156

**–ü—Ä–æ–±–ª–µ–º–∞:**
```cpp
static void smooth_camera_tracking(GstNvdsVirtualCam *vcam)
{
    const gfloat DEAD_ZONE = 0.1f;

    gfloat yaw_diff = vcam->target_yaw - vcam->yaw;
    gfloat pitch_diff = vcam->target_pitch - vcam->pitch;

    if (fabs(yaw_diff) > DEAD_ZONE) {
        vcam->yaw += yaw_diff * vcam->smooth_factor;
    }

    if (fabs(pitch_diff) > DEAD_ZONE) {
        vcam->pitch += pitch_diff * vcam->smooth_factor;
    }

    // Roll –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ yaw –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è
    static gfloat last_yaw_for_roll = 0.0f;
    if (fabs(vcam->yaw - last_yaw_for_roll) > 0.01f) {
        const gfloat ROLL_MAX = NvdsVirtualCamConfig::ROLL_MAX;
        gfloat normalized_pos = vcam->yaw / 90.0f;
        vcam->roll = normalized_pos * ROLL_MAX;
        last_yaw_for_roll = vcam->yaw;
    }
}
```

–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä**, –¥–∞–∂–µ –µ—Å–ª–∏ auto_follow –≤—ã–∫–ª—é—á–µ–Ω.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `auto_follow = true`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ò–ó–ö–ò–ô (–≤–ª–∏—è–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–∞ CPU)

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª FPS | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|---|----------|-----------|---------------|-----------|
| 1 | Nearest neighbor –≤–º–µ—Å—Ç–æ bilinear | –í–´–°–û–ö–ò–ô | -5-10% (–∫–∞—á–µ—Å—Ç–≤–æ!) | –°—Ä–µ–¥–Ω—è—è |
| 2 | Block size 16√ó16 | –°–†–ï–î–ù–ò–ô | +5-15% | –ù–∏–∑–∫–∞—è |
| 3 | cudaStreamSynchronize –ø–æ—Å–ª–µ kernel | –í–´–°–û–ö–ò–ô | +10-20% | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |
| 4 | Debug –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ kernel | –ù–ò–ó–ö–ò–ô | +1-2% | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |
| 5 | LUT –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –•–û–†–û–®–û | - | - |
| 6 | –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ rays | ‚úÖ –•–û–†–û–®–û | - | - |
| 7 | –ì–ª–æ–±–∞–ª—å–Ω—ã–π EGL mutex | –ù–ò–ó–ö–ò–ô | +2-5% (multi-instance) | –°—Ä–µ–¥–Ω—è—è |
| 8 | –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è tracking | –ù–ò–ó–ö–ò–ô | +1% | –ù–∏–∑–∫–∞—è |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã (30 –º–∏–Ω—É—Ç)

1. **–£–±—Ä–∞—Ç—å `cudaStreamSynchronize`** (—Å—Ç—Ä–æ–∫–∞ 330)
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +10-20% FPS
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: 1 —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞

2. **–ò–∑–º–µ–Ω–∏—Ç—å block size –Ω–∞ 32√ó16** (—Å—Ç—Ä–æ–∫–∏ 54, 169, 304)
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +5-15% FPS
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: 3 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

3. **–£–±—Ä–∞—Ç—å debug –ø—Ä–æ–≤–µ—Ä–∫–∏** (—Å—Ç—Ä–æ–∫–∏ 251-258, 288-290)
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +1-2% FPS
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** **47.90 FPS ‚Üí 55-65 FPS** (+15-35%)

---

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ (2-3 —á–∞—Å–∞)

4. **–î–æ–±–∞–≤–∏—Ç—å –±–∏–ª–∏–Ω–µ–π–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é**
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: -5-10% FPS, –Ω–æ +100% –∫–∞—á–µ—Å—Ç–≤–∞
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π kernel (~50 —Å—Ç—Ä–æ–∫)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –ø–∏–∫—Å–µ–ª–∏–∑–∞—Ü–∏–∏

---

### –§–∞–∑–∞ 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å texture memory –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º—ã**
   - Hardware –±–∏–ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à L2
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +10-20% FPS –ø—Ä–∏ –±–∏–ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è (~100-150 —Å—Ç—Ä–æ–∫)

6. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è EGL –∫—ç—à–∞**
   - Lock-free —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–ª–∏ per-instance
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª: +2-5% (—Ç–æ–ª—å–∫–æ multi-instance)
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è

---

## ‚ö†Ô∏è –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–°–õ–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å:

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –û–∂–∏–¥–∞–Ω–∏–µ | –†–µ–∞–ª—å–Ω–æ—Å—Ç—å | –ò–∑–º–µ–Ω–µ–Ω–∏–µ FPS |
|-------------|----------|------------|---------------|
| cudaStreamSynchronize | +10-20% | +0.1% | 47.90 ‚Üí 47.96 |
| Block size 32√ó16 | +5-15% | **-8.5%** ‚ùå | 47.90 ‚Üí 43.88 |
| Block size 32√ó8 | +5-15% | **-7.4%** ‚ùå | 47.90 ‚Üí 44.40 |
| –£–¥–∞–ª–µ–Ω–∏–µ debug | +1-2% | **-5.3%** ‚ùå | 47.90 ‚Üí 45.42 |

**–í—ã–≤–æ–¥:** –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (16√ó16) —É–∂–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞!

–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–º. –≤ [OPTIMIZATION_RESULTS.md](./OPTIMIZATION_RESULTS.md)

---

## üí° –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ —Ö–æ—Ä–æ—à–æ (–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å):

1. **LUT –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–µ—Ä–µ—Å—á—ë—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–≥–ª–æ–≤
2. **–ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ camera rays** - –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ FOV
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ CUDA streams** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ GPU
4. **EGL –∫—ç—à** - –∏–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –±—É—Ñ–µ—Ä–æ–≤
5. **Block size 16√ó16** - –æ–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è occupancy –Ω–∞ Jetson Orin
6. **cudaStreamSync** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ, –Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

### ‚ö†Ô∏è –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ "—É–ª—É—á—à–∞—Ç—å":

1. ~~**cudaStreamSynchronize –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**~~ - –¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ +0.1%
2. ~~**Block size 16√ó16 –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω**~~ - –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω! (32√ó16 —Ö—É–∂–µ –Ω–∞ 8.5%)
3. **Nearest neighbor** - –±—ã—Å—Ç—Ä–æ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á

### üéØ –†–µ–∞–ª—å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- **–¢–µ–∫—É—â–∏–π FPS:** 47.90 ‚úÖ
- ~~**–ü–æ—Å–ª–µ –±—ã—Å—Ç—Ä—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:** 55-65 FPS~~ - **–ù–ï –°–†–ê–ë–û–¢–ê–õ–û**
- **–†–µ–∞–ª—å–Ω—ã–µ "–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏" –¥–∞–ª–∏:** 43-48 FPS (—É—Ö—É–¥—à–µ–Ω–∏–µ –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)

**–í—ã–≤–æ–¥:** –ü–ª–∞–≥–∏–Ω —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω! –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–æ–≤—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤.

---

## üöÄ –ß—Ç–æ –î–ï–ô–°–¢–í–ò–¢–ï–õ–¨–ù–û —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ

1. **Texture memory + hardware bilinear** - +–∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ +–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–∞–Ω–æ—Ä–∞–º—ã** - +–∫–∞—á–µ—Å—Ç–≤–æ
3. **Shared memory –¥–ª—è LUT** - +5-10% FPS (—Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

---

## üî¨ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤

1. ~~**–°–Ω–∞—á–∞–ª–∞:** –£–±—Ä–∞—Ç—å `cudaStreamSynchronize` –∏ –∏–∑–º–µ–Ω–∏—Ç—å block size~~ - –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û, –Ω–µ –ø–æ–º–æ–≥–ª–æ
2. **–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (47.90 FPS - –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!)
3. **–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å texture memory –¥–ª—è –±–∏–ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
4. **–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è FPS:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏—á–∏–Ω–≥ (–æ–Ω –º–µ–¥–ª–µ–Ω–Ω–µ–µ - 40.84 vs 47.90)

---

**–ò—Ç–æ–≥:** –ü–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç **–û–¢–õ–ò–ß–ù–û** —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π. "–û—á–µ–≤–∏–¥–Ω—ã–µ" –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ–∫–∞–∑–∞–ª–∏—Å—å **–≤—Ä–µ–¥–Ω—ã**. –î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –Ω—É–∂–Ω—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–æ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã, –∞ –Ω–µ tweaking –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
