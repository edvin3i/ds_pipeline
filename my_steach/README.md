# NvDsStitch Plugin - Panoramic Video Stitching

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π DeepStream –ø–ª–∞–≥–∏–Ω –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º–Ω–æ–≥–æ —Å—Ç–∏—á–∏–Ω–≥–∞ –¥–≤—É—Ö 4K –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ Jetson Orin.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
my_steach/
‚îú‚îÄ‚îÄ src/                              # –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsstitch.cpp            # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsstitch.h              # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsstitch_allocator.cpp  # –ê–ª–ª–æ–∫–∞—Ç–æ—Ä –±—É—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsstitch_allocator.h
‚îÇ   ‚îú‚îÄ‚îÄ gstnvdsbufferpool.h
‚îÇ   ‚îú‚îÄ‚îÄ cuda_stitch_kernel.cu        # CUDA —è–¥—Ä–æ –¥–ª—è —Å—Ç–∏—á–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ cuda_stitch_kernel.h
‚îÇ   ‚îî‚îÄ‚îÄ nvdsstitch_config.h          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (block size)
‚îú‚îÄ‚îÄ warp_maps/                        # LUT –∫–∞—Ä—Ç—ã –¥–ª—è –≤–∞—Ä–ø–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ left_map_x.bin
‚îÇ   ‚îú‚îÄ‚îÄ left_map_y.bin
‚îÇ   ‚îú‚îÄ‚îÄ right_map_x.bin
‚îÇ   ‚îî‚îÄ‚îÄ right_map_y.bin
‚îú‚îÄ‚îÄ libnvdsstitch.so                  # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω
‚îú‚îÄ‚îÄ Makefile                          # Makefile –¥–ª—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ panorama_stream.py                # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ panorama_cameras_realtime.py      # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–∞–º–µ—Ä
‚îú‚îÄ‚îÄ left.mp4 / right.mp4              # –¢–µ—Å—Ç–æ–≤—ã–µ –≤–∏–¥–µ–æ
‚îî‚îÄ‚îÄ ARCHITECTURE.md                   # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–±–æ—Ä–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

```bash
cd /home/nvidia/deep_cv_football/my_steach
make clean
make
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞

```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–µ–≤—ã–π –∏ –ø—Ä–∞–≤—ã–π –≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã (left.mp4, right.mp4)
python3 panorama_stream.py
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–ª–∞–≥–∏–Ω–æ–≤
sudo cp libnvdsstitch.so /usr/lib/aarch64-linux-gnu/gstreamer-1.0/
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** | 2 √ó 3840√ó2160 (4K) |
| **–í—ã—Ö–æ–¥–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ** | 6528√ó1632 (Panorama) |
| **FPS** | **44.43** |
| **Latency (avg)** | **17.52 ms** |
| **GPU –ø–∞–º—è—Ç—å** | ~633 MB |
| **GPU –∑–∞–≥—Ä—É–∑–∫–∞** | 85% |

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ **CUDA block size 32√ó8** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π memory coalescing (+19.4% FPS)
- ‚úÖ **EGL cache** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ EGL-CUDA —Ä–µ—Å—É—Ä—Å–æ–≤ (99% hit rate)
- ‚úÖ **Fixed buffer pool** - 8 –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤—ã—Ö–æ–¥–Ω—ã—Ö –±—É—Ñ–µ—Ä–æ–≤
- ‚úÖ **GPU LUT maps** - 6 –∫–∞—Ä—Ç –≤–∞—Ä–ø–∏–Ω–≥–∞ –≤ GPU –ø–∞–º—è—Ç–∏ (read-only)
- ‚úÖ **Error recovery** - reset CUDA state + NULL checking

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

**src/nvdsstitch_config.h:**
```cpp
constexpr int BLOCK_SIZE_X = 32;  // 1 warp = –∏–¥–µ–∞–ª—å–Ω—ã–π coalescing
constexpr int BLOCK_SIZE_Y = 8;   // 256 threads, –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π occupancy
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ CUDA —è–¥—Ä–∞

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/cuda_stitch_kernel.cu`
2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `make`
3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ: `python3 panorama_stream.py`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–ª–æ–∫–æ–≤

1. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/nvdsstitch_config.h`
2. –ò–∑–º–µ–Ω–∏—Ç–µ `BLOCK_SIZE_X` –∏ `BLOCK_SIZE_Y`
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ: `make`

**–í–∞–∂–Ω–æ:** `BLOCK_SIZE_X` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω 32 (—Ä–∞–∑–º–µ—Ä warp)!

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ [ARCHITECTURE.md](ARCHITECTURE.md), –≤–∫–ª—é—á–∞—è:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –±—É—Ñ–µ—Ä–æ–≤
- –ú–µ—Ö–∞–Ω–∏–∑–º EGL cache
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ü–æ–ª–Ω—ã–π breakdown –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- Troubleshooting guide

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–ª–∞–≥–∏–Ω –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ stdout:
```bash
# –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_DEBUG   - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
LOG_INFO    - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
LOG_WARNING - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–Ω–µ–ø–æ–ª–Ω—ã–π batch, –∏ —Ç.–¥.)
LOG_ERROR   - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (CUDA, NULL pointer)
```

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç FPS
```bash
# –¢–µ—Å—Ç –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
python3 test_fps.py left.mp4 right.mp4

# –¢–µ—Å—Ç –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
python3 test_fps.py left.mp4 right.mp4 60
```

**–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç:**
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π FPS –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- –°—Ä–µ–¥–Ω–∏–π FPS –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
- –°—Ä–µ–¥–Ω—é—é latency
- –û—Ü–µ–Ω–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ª–æ–≥–∞–º–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å –∏–∑–º–µ—Ä–µ–Ω–∏–µ–º FPS
GST_DEBUG=nvdsstitch:3 python3 panorama_stream.py left.mp4 right.mp4

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–ª–∞–≥–∏–Ω–∞
GST_DEBUG=nvdsstitch:5 python3 panorama_stream.py left.mp4 right.mp4 2>&1 | grep "nvdsstitch"
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è**: –ü–ª–∞–≥–∏–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 3840√ó2160 ‚Üí 6528√ó1632
2. **–¢—Ä–µ–±—É–µ—Ç—Å—è 2 –≤—Ö–æ–¥–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞**: nvstreammux –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å batch size = 2
3. **GPU –ø–∞–º—è—Ç—å**: –¢—Ä–µ–±—É–µ—Ç—Å—è ~633 MB —Å–≤–æ–±–æ–¥–Ω–æ–π GPU –ø–∞–º—è—Ç–∏
4. **LUT –∫–∞—Ä—Ç—ã**: –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –ø–∞–ø–∫–µ `warp_maps/`

## üêõ Troubleshooting

–°–º. —Ä–∞–∑–¥–µ–ª "Troubleshooting" –≤ [ARCHITECTURE.md](ARCHITECTURE.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º.

## üìù –í–µ—Ä—Å–∏—è

–¢–µ–∫—É—â–∞—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: **v1.0-optimized**
- CUDA block size: 32√ó8
- Stability rating: 7.0/10
- Performance: +19.4% vs baseline
